var ProcessDiagramGenerator={options:{},processDiagramCanvas:[],activityDrawInstructions:{},processDiagrams:{},diagramBreadCrumbs:null,init:function(){this.activityDrawInstructions.startEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawNoneStartEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.startTimerEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawTimerStartEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,t.getProperty("name"))},this.activityDrawInstructions.messageStartEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawMessageStartEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,t.getProperty("name"))},this.activityDrawInstructions.startSignalEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawSignalStartEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,t.getProperty("name"))},this.activityDrawInstructions.startMultipleEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawMultipleStartEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,t.getProperty("name"))},this.activityDrawInstructions.intermediateSignalCatch=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawCatchingSignalEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,null);var a=ProcessDiagramGenerator.getActivitiLabel(t);a&&e.drawLabel(a.text,a.x,a.y,a.width,a.height)},this.activityDrawInstructions.intermediateMessageCatch=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawCatchingMessageEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,null);var a=ProcessDiagramGenerator.getActivitiLabel(t);a&&e.drawLabel(a.text,a.x,a.y,a.width,a.height)},this.activityDrawInstructions.intermediateMultipleCatch=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawCatchingMultipleEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,null);var a=ProcessDiagramGenerator.getActivitiLabel(t);a&&e.drawLabel(a.text,a.x,a.y,a.width,a.height)},this.activityDrawInstructions.intermediateSignalThrow=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawThrowingSignalEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),t.getProperty("name"));var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.intermediateMessageThrow=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawThrowingMessageEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),t.getProperty("name"));var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.intermediateMultipleThrow=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawThrowingMultipleEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),t.getProperty("name"));var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.intermediateThrowEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawThrowingNoneEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),t.getProperty("name"));var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.endEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawNoneEndEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.errorEndEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawErrorEndEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),null);var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.messageEndEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawMessageEndEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),null);var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.signalEndEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawSignalEndEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),null);var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.multipleEndEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawMultipleEndEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),null);var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.terminateEndEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawTerminateEndEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight());var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.errorStartEvent=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawErrorStartEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),t.getProperty("name"));var i=ProcessDiagramGenerator.getActivitiLabel(t);i&&e.drawLabel(i.text,i.x,i.y,i.width,i.height)},this.activityDrawInstructions.task=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t)},this.activityDrawInstructions.userTask=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawUserTask(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.scriptTask=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawScriptTask(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.serviceTask=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawServiceTask(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.receiveTask=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawReceiveTask(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.sendTask=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawSendTask(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.manualTask=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawManualTask(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.businessRuleTask=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawBusinessRuleTask(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.exclusiveGateway=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawExclusiveGateway(t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.inclusiveGateway=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawInclusiveGateway(t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.parallelGateway=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawParallelGateway(t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.eventBasedGateway=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawEventBasedGateway(t.getX(),t.getY(),t.getWidth(),t.getHeight())},this.activityDrawInstructions.boundaryTimer=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawCatchingTimerEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,null);var a=ProcessDiagramGenerator.getActivitiLabel(t);a&&e.drawLabel(a.text,a.x,a.y,a.width,a.height)},this.activityDrawInstructions.boundaryError=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawCatchingErrorEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,null);var a=ProcessDiagramGenerator.getActivitiLabel(t);a&&e.drawLabel(a.text,a.x,a.y,a.width,a.height)},this.activityDrawInstructions.boundarySignal=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawCatchingSignalEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,null);var a=ProcessDiagramGenerator.getActivitiLabel(t);a&&e.drawLabel(a.text,a.x,a.y,a.width,a.height)},this.activityDrawInstructions.boundaryMessage=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isInterrupting");e.drawCatchingMessageEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,null);var a=ProcessDiagramGenerator.getActivitiLabel(t);a&&e.drawLabel(a.text,a.x,a.y,a.width,a.height)},this.activityDrawInstructions.intermediateTimer=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=null;e.drawCatchingTimerEvent(t.getX(),t.getY(),t.getWidth(),t.getHeight(),i,t.getProperty("name"))},this.activityDrawInstructions.subProcess=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t);var i=t.getProperty("isExpanded"),a=t.getProperty("triggeredByEvent");void 0==a&&(a=!0),a=!1,void 0!=i&&0==i?e.drawCollapsedSubProcess(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight(),a):e.drawExpandedSubProcess(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight(),a)},this.activityDrawInstructions.callActivity=function(){var t=this.activity,e=this.processDiagramCanvas;e.setConextObject(t),e.drawCollapsedCallActivity(t.getProperty("name"),t.getX(),t.getY(),t.getWidth(),t.getHeight())},$(document).ready(function(){document.body.oncontextmenu=function(){return"shape"==window.event.srcElement.tagName||"DIV"==window.event.srcElement.tagName&&"diagram"==window.event.srcElement.parentElement.className?!1:!Object.isSVGElement(window.event.srcElement)}})},getActivitiLabel:function(t){return{text:t.getProperty("name"),x:t.getX()+.5+t.getWidth()/2,y:t.getY()+.5+t.getHeight()+ICON_PADDING,width:100,height:0}},generateDiagram:function(t){var e=t.processDefinition.id;if(void 0==this.getProcessDiagram(e)){var i=this.initProcessDiagramCanvas(t),a=i.diagramCanvas;if(void 0!=t.participantProcess){var r=t.participantProcess;a.drawPoolOrLane(r.x,r.y,r.width,r.height,r.name)}var s=t.laneSets,n=t.activities,o=t.sequenceFlows;pb1.set("value",0);var g=0;if(s)for(var c in s)g+=s[c].lanes.length;n&&(g+=n.length),o&&(g+=o.length);var v=g>0?100/g:0,d=0,h=new $.AsyncQueue;h.add(function(){s||(s=[])});for(var c in s){var u=s[c];h.add(u.lanes,function(t,e){d+=v,pb1.set("value",parseInt(d)),a.drawPoolOrLane(e.x,e.y,e.width,e.height,e.name)})}h.add(function(){n||(n=[])});var l=n.length;h.add(n,function(t,e){var i=new ActivityImpl(e);l--,d+=v,pb1.set("value",parseInt(d)),ProcessDiagramGenerator.drawActivity(a,i)}),h.add(function(){o||(o=[])});var y=o.length;h.add(o,function(t,e){var i=[];for(var r in e.xPointArray)i[r]={x:e.xPointArray[r],y:e.yPointArray[r]};var s,n,o=e.isDefault,g=e.isConditional,c=e.isHighLighted,h=e.flow,u=h.match(/\((.*)\)--.*-->\((.*)\)/);null!=u&&(s=u[1],n=u[2]),e.sourceActivityId=s,e.destinationActivityId=n,y--,d+=v,pb1.set("value",parseInt(d)),a.setConextObject(e),a.drawSequenceflow(i,g,o,c)}),h.onComplete(function(){100>d&&pb1.set("value",100)}),h.run()}},getProcessDiagram:function(t){return this.processDiagrams[t]},initProcessDiagramCanvas:function(t){var e=0,i=0,a=0,r=0;if(void 0!=t.participantProcess){var s=t.participantProcess;e=s.x,i=s.x+s.width,a=s.y,r=s.y+s.height}var n=t.activities;for(var o in n){var g=n[o],c=new ActivityImpl(g);c.getX()+c.getWidth()>i&&(i=c.getX()+c.getWidth()),c.getX()<e&&(e=c.getX()),c.getY()+c.getHeight()>r&&(r=c.getY()+c.getHeight()),c.getY()<a&&(a=c.getY())}var v=t.sequenceFlows;for(var o in v){var d=v[o],h=[];for(var u in d.xPointArray)h[u]={x:d.xPointArray[u],y:d.yPointArray[u]},h[u].x>i&&(i=h[u].x),h[u].x<e&&(e=h[u].x),h[u].y>r&&(r=h[u].y),h[u].y<a&&(a=h[u].y)}var l=t.laneSets;for(var o in l){var y=l[o];for(var u in y.lanes){var m=y.lanes[u];m.x+m.width>i&&(i=m.x+m.width),m.x<e&&(e=m.x),m.y+m.height>r&&(r=m.y+m.height),m.y<a&&(a=m.y)}}var p=new ProcessDiagramCanvas;if(p){var D=document.getElementById(this.options.diagramHolderId);if(!D)throw{msg:"Diagram holder not found",error:"diagramHolderNotFound"};var w=document.createElement("DIV");w.id=t.processDefinition.id,w.className="diagram",D.appendChild(w),p.init(i+20,r+20,t.processDefinition.id),this.processDiagrams[t.processDefinition.id]={processDefinitionDiagramLayout:t,diagramCanvas:p}}return this.getProcessDiagram(t.processDefinition.id)},drawActivity:function(t,e){var i=e.getProperty("type"),a=this.activityDrawInstructions[i];if(null!=a&&a.apply({processDiagramCanvas:t,activity:e}),void 0!=e.getProperty("multiInstance")||void 0!=e.getProperty("collapsed")){var r="sequential"==e.getProperty("multiInstance"),s="parrallel"==e.getProperty("multiInstance"),n=e.getProperty("collapsed");t.drawActivityMarkers(e.getX(),e.getY(),e.getWidth(),e.getHeight(),r,s,n)}},setHighLights:function(t){if(void 0!=t.processDefinitionId){var e=this.getProcessDiagram(t.processDefinitionId);if(void 0!=e){var i=e.diagramCanvas;for(var a in t.activities){var r=t.activities[a];i.highLightActivity(r)}for(var a in t.flows){var s=t.flows[a],n=i.g.getById(s),o=n.data("contextObject");o.isHighLighted=!0,i.highLightFlow(s)}}}},drawHighLights:function(t){ActivitiRest.getHighLights(t,this._drawHighLights)},_drawHighLights:function(){var t=this.highLights;ProcessDiagramGenerator.setHighLights(t)},drawDiagram:function(t){var e=$("#"+this.options.diagramHolderId+" div.diagram");e.addClass("hidden"),t.indexOf(":")<0?ActivitiRest.getProcessDefinitionByKey(t,this._drawDiagram):this._drawDiagram.apply({processDefinitionId:t})},_drawDiagram:function(){var t=this.processDefinitionId;ProcessDiagramGenerator.addBreadCrumbsItem(t);var e=ProcessDiagramGenerator.getProcessDiagram(t);if(void 0!=e&&null!=e){var i=document.getElementById(t);$(i).removeClass("hidden");var a=e.processDefinitionDiagramLayout;return void ProcessDiagramGenerator.generateDiagram(a)}ActivitiRest.getProcessDefinition(t,ProcessDiagramGenerator._generateDiagram)},_generateDiagram:function(){var t=this.processDefinitionDiagramLayout;pb1.set("value",0),ProcessDiagramGenerator.generateDiagram(t)},getProcessDefinitionByKey:function(t){var e,i=Lang.sub(this.options.processDefinitionByKeyUrl,{processDefinitionKey:t});return $.ajax({url:i,type:"POST",dataType:"json",cache:!1,async:!1}).done(function(t){e=t}).fail(function(){}),e?e:null},addBreadCrumbsItem:function(t){var e="<ul></ul>",i='<li id="{id}", processDefinitionId="{processDefinitionId}"><span>{name}</span></li>';if(this.diagramBreadCrumbs||(this.diagramBreadCrumbs=$("#"+this.options.diagramBreadCrumbsId)),this.diagramBreadCrumbs){var a=this.diagramBreadCrumbs.find("ul");0==a.size()&&(a=$(e),this.diagramBreadCrumbs.append(a));var r=a.find("li"),s=this.currentBreadCrumbsItemId;found=!1,r.each(function(){return found||s!=$(this).attr("id")?void(found&&$(this).remove()):void(found=!0)});var n=a.find("li"),o={id:"breadCrumbsItem_"+n.size(),processDefinitionId:t,name:t},g=Lang.sub(i,o);a.append(g);var c=a.find("#"+o.id);$("#"+o.id).on("click",this._breadCrumbsItemClick),a.find("li").removeClass("selected"),c.attr("num",n.size()),c.addClass("selected"),this.currentBreadCrumbsItemId=c.attr("id")}},_breadCrumbsItemClick:function(){var t=$(this),e=(t.attr("id"),t.attr("processDefinitionId")),i=ProcessDiagramGenerator.diagramBreadCrumbs.one("ul");i.find("li").removeClass("selected"),t.addClass("selected"),ProcessDiagramGenerator.currentBreadCrumbsItemId=t.attr("id");var a=$("#"+ProcessDiagramGenerator.options.diagramHolderId+" div.diagram");a.addClass("hidden");var r=ProcessDiagramGenerator.getProcessDiagram(e),s=document.getElementById(e);if(s){$(s).removeClass("hidden");var n=r.processDefinitionDiagramLayout;ProcessDiagramGenerator.generateDiagram(n)}},showFlowInfo:function(t){var e=$("#"+this.options.diagramInfoId);if(e){var i={flow:t.flow,isDefault:t.isDefault?"true":"",isConditional:t.isConditional?"true":"",isHighLighted:t.isHighLighted?"true":"",sourceActivityId:t.sourceActivityId,destinationActivityId:t.destinationActivityId},a="<div>{flow}</div><div><b>sourceActivityId</b>: {sourceActivityId}</div><div><b>destinationActivityId</b>: {destinationActivityId}</div><div><b>isDefault</b>: {isDefault}</div><div><b>isConditional</b>: {isConditional}</div><div><b>isHighLighted</b>: {isHighLighted}</div>",r=Lang.sub(a,i);e.html(r)}},showActivityInfo:function(t){var e=$("#"+this.options.diagramInfoId);if(e){var i={activityId:t.getId(),name:t.getProperty("name"),type:t.getProperty("type")},a="<div><b>activityId</b>: {activityId}</div><div><b>name</b>: {name}</div><div><b>type</b>: {type}</div>",r="<div><b>collapsed</b>: {collapsed}</div><div><b>processDefinitonKey</b>: {processDefinitonKey}</div>",s=a;"callActivity"==t.getProperty("type")?(i.collapsed=t.getProperty("collapsed"),i.processDefinitonKey=t.getProperty("processDefinitonKey"),s+=r):"callActivity"==t.getProperty("type");var n=Lang.sub(s,i);e.html(n)}},hideInfo:function(){var t=$("#"+this.options.diagramInfoId);t&&t.html("")},vvoid:function(){}},Lang={SUBREGEX:/\{\s*([^\|\}]+?)\s*(?:\|([^\}]*))?\s*\}/g,UNDEFINED:"undefined",isUndefined:function(t){return typeof t===Lang.UNDEFINED},sub:function(t,e){return t.replace?t.replace(Lang.SUBREGEX,function(t,i){return Lang.isUndefined(e[i])?t:e[i]}):t}};Lang.isUndefined(console)&&(console={log:function(){},warn:function(){},error:function(){}}),ProcessDiagramGenerator.init();