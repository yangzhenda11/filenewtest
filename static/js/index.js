function data_permFilter(e){for(var n=e.querySelectorAll("[data-permcheck]"),l=globalConfig.permissions,a=0;a<n.length;a++)""!=$(n[a]).data("permcheck")&&$.inArray($(n[a]).data("permcheck"),l)<0?$(n[a]).remove():$(n[a]).removeClass("hidden")}function data_tpFilter(e){var n=globalConfig.permissions;return $.inArray(e,n)>=0?!0:!1}function changeStaffOrg(e){function n(e){e.status?window.location.reload():layer.msg(data.message)}App.formAjaxJson(globalConfig.serverPath+"changestation/"+e,"GET",null,n,null,null,null,!1)}function validatePassword(){$("#passwdForm").bootstrapValidator({live:"enabled",trigger:"live focus blur keyup change",message:"校验未通过",container:"popover",fields:{passwd:{validators:{notEmpty:{message:"请输入新密码"},regexp:{regexp:/^(?!.*')(?!.*\^)(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,18}$/,message:"请输入6到18位同时包含大小写字母及数字密码且不包含'^"},identical:{field:"passConfirm",message:"两次输入的密码不一致。"}}},passConfirm:{validators:{notEmpty:{message:"请再次输入密码确认"},identical:{field:"passwd",message:"两次输入的密码不一致。"}}}}}).on("success.form.bv",function(e){e.preventDefault(),changePasswd()})}function updatePasswd(){$("#editPasswd").modal("show"),$("#passwdForm input").val(""),$("#passwdForm").data("bootstrapValidator")||validatePassword()}function changePasswd(){function e(e){function n(e){e.data&&layer.alert("用户["+globalConfig.curStaffName+"]的密码已经修改，为安全起见需退出系统重新登录,点击确认按钮退出系统!",{icon:1,closeBtn:0},function(){logout()})}function l(){layer.msg("修改密码失败！")}var a=$("#passwdForm input[name='passwd']").val(),t=e.data.modulus,o=e.data.exponent;if(256!=a.length)var s=RSAUtils.getKeyPair(o,"",t);var r=RSAUtils.encryptedString(s,a);App.formAjaxJson(globalConfig.serverPath+"staffs/"+globalConfig.curStaffId+"/main/passwd?"+App.timestamp(),"GET",{passwd:r},n,l,null,null,!1)}App.formAjaxJson(globalConfig.serverPath+"upfKeyPair?"+App.timestamp(),"GET",null,e,null,null,null,!1)}function logout(){function e(){function e(){window.location.href="login.html"}App.formAjaxJson(globalConfig.serverPath+"logout","POST",null,e)}clearAllCookie(),App.formAjaxJson(globalConfig.serverPath+"staffs/removeStaffCache","POST",null,e)}function clearAllCookie(){var e=document.cookie.match(/[^ =;]+(?=\=)/g);if(e)for(var n=e.length;n--;)document.cookie=e[n]+"=0;expires="+new Date(0).toUTCString()}function setMessageTipNumber(){function e(e){e&&$("#messageTipNumber").text(e.recordsTotal)}var n={staffId:globalConfig.curStaffId,draw:999,start:0,length:0};App.formAjaxJson(globalConfig.serverPath+"workflowrest/taskToDo","get",n,e,null,null,!1)}function hideNavbar(){$("body").addClass("hideNavbar"),$hidemenu.show()}function launchFullscreen(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function checkFullscreen(){var e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;e?($("#fullScreen").removeClass("fa-expand").addClass("fa-compress"),$("#fullScreen").parent().attr("title","点击退出全屏")):($("#fullScreen").removeClass("fa-compress").addClass("fa-expand"),$("#fullScreen").parent().attr("title","点击全屏"))}var globalConfig={staticPath:"/",serverPath:"/",curStaffOrgId:null,curOrgId:null,curCompanyId:null,curStaffName:"",curStaffId:null,permissions:[],provCode:null,loginSwitchSuccess:null,mainOrgFlag:null,curConfigs:{}},ace_menus=null;$(document).ready(function(){function e(e){function n(e){var n=e.data;if(""!=e.data){var l={};$.each(n,function(e,n){l[n.code]=n.val}),globalConfig.curConfigs=l}else globalConfig.curConfigs=o}function l(){globalConfig.curConfigs=o}function a(){globalConfig.curConfigs=o}function t(e){globalConfig.loginSwitchSuccess=""!=e.data?e.data:1}var o={config_page_size:"10,20,50",message_space:"300000",oke_active_time:"1",oken_maximum_number:"10"},s=e.data;if(globalConfig.provCode=s.provCode,globalConfig.curStaffId=s.staffId,globalConfig.curStaffName=s.staffName,globalConfig.curStaffOrgId=s.staffOrgId,globalConfig.curOrgId=s.orgId,globalConfig.curCompanyId=s.companyId,globalConfig.mainOrgFlag=s.mainOrgFlag,globalConfig.permissions=s.permissions,ace_menus=s.menus,$(".user-info").html("<small>欢迎,</small>"+s.staffName),s.staffOrgs.length>0)for(var r=0;r<s.staffOrgs.length;r++)$(".user-menu").prepend(s.staffOrgId==s.staffOrgs[r].staffOrgId?'<li> <a id="staffOrg'+s.staffOrgs[r].staffOrgId+' " href="javascript:changeStaffOrg('+s.staffOrgs[r].staffOrgId+');" style="color:red;"> <i class="ace-icon fa fa-cube"></i> '+s.staffOrgs[r].orgName+"</a> </li>":'<li> <a id="staffOrg'+s.staffOrgs[r].staffOrgId+' " href="javascript:changeStaffOrg('+s.staffOrgs[r].staffOrgId+');" style="color:black;"> <i class="ace-icon fa fa-cube"></i> '+s.staffOrgs[r].orgName+"</a> </li>");App.formAjaxJson(globalConfig.serverPath+"personalConfig/list","GET",{staffOrgId:globalConfig.curStaffOrgId,draw:1,start:0,length:100},n,l,a,null,!1),App.formAjaxJson(globalConfig.serverPath+"configs/getSysConfig/getCloudPortSwitch","get",null,t,null,null,null,!1),setMessageTipNumber();setInterval(setMessageTipNumber,globalConfig.curConfigs.message_space);$("#iframeTaskTodo").attr("src","html/workflow/tasklist/task-todo.html")}App.formAjaxJson(globalConfig.serverPath+"myinfo?"+App.timestamp(),"GET",null,e,null,null,null,!1)}),$("#editPasswd").on("hide.bs.modal",function(){$("#passwdForm").bootstrapValidator("resetForm",!0)});var $hidemenu=$("#hidemenu");$hidemenu.click(function(){$("body").removeClass("hideNavbar"),$(this).hide()}),$("#loginInfoCon").hover(function(){$("#user-menu").show()},function(){$("#user-menu").hide()}),$("#fullScreen").on("click",function(){var e=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled;if(!e)return layer.msg("当前浏览器不支持全屏操作",{icon:2}),!1;var n=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;n?exitFullscreen():launchFullscreen(document.documentElement)}),document.addEventListener("fullscreenchange",function(){checkFullscreen()}),document.addEventListener("mozfullscreenchange",function(){checkFullscreen()}),document.addEventListener("webkitfullscreenchange",function(){checkFullscreen()}),document.addEventListener("MSFullscreenChange",function(){checkFullscreen()});