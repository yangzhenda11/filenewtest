<div class="form-fieldset" id="differencesThat">
	<div class="form-fieldset-title">
		<span><i class="iconfont icon-layers"></i> 开票信息</span>
		<div class="form-fieldset-tools">
			<a href="#" class="form-collapse"><i class="fa fa-angle-up"></i></a>
		</div>
	</div>
	<div class="form-fieldset-body">
		<div class="row">
			<div class="portlet-body">
				<button class="btn red" id="addInvoiceBtn"><i class="iconfont icon-add"></i> 新增</button>
				<table id="invoiceInfoTable" class="table table-striped table-bordered table-hover table-header-fixed">

					<tr>
						<td></td>
						<td>122122</td>
						<td>机动车销售统一发票</td>
					</tr>
				</table>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	/*
	 * 返回本页面数据，若无返回{}，若不提交本页面的值可删除此方法
	 */
	function getValue_invoice(){
		var value = getInvoiceInfoTable();
		if(value){
			return {y:value}
		}else{
			return false;
		}
	}
	
	
	
	var invoiceType = {};
	var invoiceTypeData = {};
	var invoiceInfoTable = null;
	getInvoiceType();

	/*
	 * 获取开票信息字典值
	 */
	function getInvoiceType() {
		App.formAjaxJson(serverPath + "dicts/listChildrenByDicttId", "post", JSON.stringify({
			"dictId": 9025
		}), successCallback, null, null, null, false);

		function successCallback(result) {
			if(result.data != "") {
				var ary = [];
				for(var k = 0; k < result.data.length; k++){
					ary.push(result.data[k].dictLabel);
					invoiceType[result.data[k].dictLabel] = result.data[k].dictLabel;
					invoiceTypeData[result.data[k].dictLabel] = result.data[k].dictValue;
				}
				var nary = ary.sort();
				for(var i = 0; i < ary.length; i++) {
					if(nary[i] == nary[i + 1]) {
						layer.alert("字典'开票类型'中存在重复内容：" + nary[i]+"请处理后再操作！");
						return false;
					}
				};
				initInvoiceInfoTable();
			}
		}
	}
	/*
	 * 初始化开票信息表格
	 */
	function initInvoiceInfoTable(){
		invoiceInfoTable = App.initEditableDatatables('#invoiceInfoTable', {
			"addRowBtn": "#addInvoiceBtn",
			"columns": [
				{
					"data": "invoiceTitle",
					"title": "发票抬头",
					"className": "text-center",
					"isEditable": true
				},
				{
					"data": "invoiceType",
					"title": "开票类型",
					"className": "text-center",
					"isEditable": true,
					"isSelectData": invoiceType,
					"selectPlaceholder":"请选择开票类型"
				}
			],
			"fnValidEditRow": function(row) {
				var flag = true;
				if(row.invoiceTitle == '') {
					layer.msg("发票抬头不能为空")
					flag = false;
				}else if(row.invoiceType == ''){
					layer.msg("请选择开票类型")
					flag = false;
				}
				return flag;
			}
		});
	}
	function getInvoiceInfoTable(){
		var invoiceInfoTableData = invoiceInfoTable.fnGetData();
		var returnData = [];
		for(var o = 0; o < invoiceInfoTableData.length; o++){
			if(invoiceInfoTableData[o].invoiceTitle == "" || invoiceInfoTableData[o].invoiceType == ""){
				layer.alert("请先保存开票信息",{icon:2});
				return false;
			}
			var item = {
				invoiceTitle : invoiceInfoTableData[o].invoiceTitle,
				invoiceType : invoiceTypeData[invoiceInfoTableData[o].invoiceType]
			}
			returnData.push(item);
		}
		return returnData;
	}
</script>