<link rel="stylesheet" type="text/css" href="/static/data/css/commonModal.css"/>
<div class="modal-dialog" role="document" style="width: 90%;">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="myModalLabel">对方主体</h4>
		</div>
		<div class="modal-body commonModalTableBody">
			<div class="portlet-body">
				<div class="pageSearchContent">
					<div class="page-search">
						<div class="row page-search-form">
							<div class="col-sm-4">
								<div class="input-group">
									<span class="input-group-addon searchLableText">对方主体名称</span>
									<input type="text" class="form-control" name="partnerName" >
								</div>
							</div>
							<div class="input-group">
								<button type="button" id="searchBtnM" class="btn btn-block red" data-loading-text="加载中.." onclick="searchOurSubject();"><i class="iconfont icon-search"></i> 查询</button>
							</div>
						</div>
					</div>
				</div>
				<div id="otherSubjectTableDom" class="tableContent">
					<table id="otherSubjectTable" class="table table-striped table-bordered table-hover table-header-fixed"></table>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<button type="button" onclick="checkOtherSubject()" class="btn btn-danger btn-circle"><i class="iconfont icon-baocun"></i> 确定</button>
			<button type="button" class="btn btn-default btn-circle" data-dismiss="modal"><i class="iconfont icon-close"></i> 关闭</button>
		</div>
	</div>
</div>
<script type="text/javascript">
	//系统全局变量获取
	var config = top.globalConfig;
	var serverPath = config.serverPath;
	var setDom = null;
	var documentHeight = 0;
	//初始化表格
	function initOtherSubject(dom, textValue, setKey, ajaxData) {
		$("#commomModal").modal("show");
		documentHeight = $(".page-content").height() - 340;
		$("#otherSubjectTableDom").css("height",documentHeight + 90);
		$('#commomModal').off("shown.bs.modal").on('shown.bs.modal', function (e) {
			getOtherSubjectData(dom, textValue, setKey, ajaxData);
		})
	}
	
	function getOtherSubjectData(dom, textValue, setKey, ajaxData) {
		setDom = dom;
		App.initDataTables('#otherSubjectTable', "#searchBtnM", {
			scrollY:documentHeight,
			ajax: {
				"type": "post",
				"contentType": "application/json",
				"url": serverPath + 'contractType/listPartner',
				"data": function(d) {
					d.type = 0;
					d.partnerName = $("input[name='partnerName']").val().trim();
					var parm = $.extend({}, ajaxData, d);
					return JSON.stringify(parm);
				}
			},
			"columns": [{
					"data": textValue,
					"className": "text-center radioCheck",
					"title": "操作",
					"render": function(data, type, full, meta) {
						var radioHtml = "<label class='ui-radio'><input type='radio' value = '" + data + "' name='checkRadio'><span></span></label>";
						return radioHtml;
					}
				},
				{
					"data": "partnerCode",
					"title": "对方主体编码"
				},
				{
					"data": "partnerName",
					"title": "对方主体名称",
					"className":"whiteSpaceNormal",
					"width":"50%"
				}
			]
		});
		//行点击事件  
		$('#otherSubjectTable tbody').on('click', 'tr', function() {
			$(this).find("input[name='checkRadio']").prop("checked", true);
			//获取选择行的内容
			var data = $('#otherSubjectTable').DataTable().row(this).data();
			if(setKey != undefined){
				if($.isArray(setKey)){
					$.each(setKey, function(k,v) {
						$(dom).data(v,data[v]);
					});
				}else{
					$(dom).data(setKey,data[setKey]);
				}
			};
		});
	}
	//搜索点击事件
	function searchOurSubject() {
		var table = $('#otherSubjectTable').DataTable();
		table.ajax.reload();
	}
	//点击确定页面dom元素选择值
	function checkOtherSubject() {
		var checkRadio = $("#otherSubjectTable").find("input[name='checkRadio']:checked");
		if(checkRadio.length == 0){
			layer.msg("请选择对方主体",{icon:2})
		}else{
			var checkValue = checkRadio.val();
			$(setDom).val(checkValue);
			$(setDom).data("exactSearch",true);
			$("#commomModal").modal("hide");
		}
	}
</script>