<div class="form-fieldset">
	<div class="form-fieldset-title">
		<span><i class="iconfont icon-layers"></i> 线路资费清单</span>
		<div class="form-fieldset-tools">
			<a href="#" class="form-collapse"><i class="fa fa-angle-up"></i></a>
		</div>
	</div>
	<div class="form-fieldset-body">
		<div class="row" id="lineChargesListContent">
			<div class="portlet-body">
				<div class="tableToobarContent hidden" id="lineChargesListToolbar">
					<button class="btn red" type="button" onclick="addIncomeLinerentTr()"><i class="iconfont icon-add"></i> 新增</button>
					<button class="btn red" type="button" onclick="delectsIncomeLinerentTr()"><i class="iconfont icon-shanchu"></i> 删除</button>
				</div>
				<div class="table-responsive">
					<table class="table table-hover table-bordered table-striped table-align" id="incomeLinerentTable" style="min-width: 1700px;">
						<thead>
							<tr>
								<th class="lineChargesTableEdit"><label class='ui-checkbox'><input type='checkbox' name='incomeLinerentCheckAll' id="incomeLinerentCheckAll"><span></span></label></th>
								<th>序号</th>
								<th><i class="iconfont icon-mi required"></i>产品类型</th>
								<th><i class="iconfont icon-mi required"></i>产品名称</th>
								<th><i class="iconfont icon-mi required"></i>产品属性</th>
								<th><i class="iconfont icon-mi required"></i>稽核标签</th>
								<th><i class="iconfont icon-mi required"></i>固定月租</th>
								<th><i class="iconfont icon-mi required"></i>线路数量</th>
								<th><i class="iconfont icon-mi required"></i>合计月租</th>
								<th><i class="iconfont icon-mi required"></i>一次性费用</th>
								<th><i class="iconfont icon-mi required"></i>其他费用</th>
								<th><i class="iconfont icon-mi required"></i>结算周期</th>
								<th class="lineChargesTableEdit">操作</th>
							</tr>
						</thead>
						<tbody id="incomeLinerentTbody">
							<tr class="emptyTr">
								<td colspan="13">暂无线路资费清单</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	/*
	 * 设置页面的id值，由保存和提交后回调
	 */
	function setPageId_incomeLinerentListId(value){
		var valueKey = 0;
		$.each($("#incomeLinerentTbody tr"), function(k,v) {
			if(!$(v).hasClass("emptyTr")){
				if($(v).data("id") != undefined){
					$(v).data("id",value[valueKey]);
					valueKey++;
				}
			}
		});
	}
	/*
	 * 返回本页面数据，若无返回{}，若不提交本页面的值可删除此方法
	 * isSubmit 提交时为true,判断页面是否要加逻辑上的验证(bootstrap-validator验证除外)
	 */
	function getValue_incomeLinerentList(isSubmit){
		var incomeLinerentDataList = [];
		$.each($("#incomeLinerentTbody tr"),function(k,v){
			if(!$(v).hasClass("emptyTr")){
				var incomeLinerentDataItem = {};
				incomeLinerentDataItem.wcardId = wcardId;
				incomeLinerentDataItem.contractNumber = contractNumber;
				incomeLinerentDataItem.linerentId = $(v).data("id");
				incomeLinerentDataItem.productKind = $(v).find(".productKind").val();
				incomeLinerentDataItem.productName = $(v).find(".productName").val();
				incomeLinerentDataItem.productAttr = $(v).find(".productAttr").val();
				incomeLinerentDataItem.auditLabel = $(v).find(".auditLabel").val();
				incomeLinerentDataItem.fixedMonthRent = $(v).find(".fixedMonthRent").val();
				incomeLinerentDataItem.lineCount = $(v).find(".lineCount").val();
				incomeLinerentDataItem.totalMonthRent = $(v).find(".totalMonthRent").val();
				incomeLinerentDataItem.onceCost = $(v).find(".onceCost").val();
				incomeLinerentDataItem.otherCost = $(v).find(".onceCost").val();
				incomeLinerentDataItem.settlementFrequency = $(v).find(".settlementFrequency").val();
				incomeLinerentDataList.push(incomeLinerentDataItem);
			}
		});
		return incomeLinerentDataList;
	}
	/*
	 * 去除多于的行
	 */
	function removeMorethan_incomeLinerentList(){
		var tableValue = getValue_incomeLinerentList();
		var emptyList = [];
		for(var i = 0; i < tableValue.length; i++){
			var tableItem = tableValue[i];
			var isEmpty = true;
			delete tableItem.contractNumber;
			delete tableItem.linerentId;
			delete tableItem.wcardId;
			if(tableItem.onceCost == 0){
				delete tableItem.onceCost;
			};
			if(tableItem.otherCost == 0){
				delete tableItem.otherCost;
			};
			$.each(tableItem, function(k,v) {
				if(v){
					isEmpty = false;
					return false;
				}
			});
			if(isEmpty){
				emptyList.push(i);
			}
		};
		$.each(emptyList, function(m,n) {
			var index = n - m;
			$("#incomeLinerentTbody tr").eq(index).remove();
		});
		addIncomeLinerentTbodyEmptyTr();
	}
	//name自增基础值
	var isCreateIncomeLinerentTrLength = 0;
	
	//产品类型字典html
	var incomeLinerentType = "";
	//产品名称字典html
	var incomeLinerentName = "";
	//产品属性字典html
	var incomeLinerentProp = "";
	//稽核标签字典html
	var incomeLinerentLable = "";
	//结算周期字典html
	var incomeLinerentCycle = "";
	//获取字典select Html;
	getIncomeLinerenDict();
	//获取线路资费信息
	getIncomeLinerenInfo();
	/*
	 * 获取线路资费信息字典值
	 */
	function getIncomeLinerenDict() {
		incomeLinerentType = createIncomeLinerenDictHtml(App.getDictInfo(9060));
		incomeLinerentName = createIncomeLinerenDictHtml(App.getDictInfo(9070));
		incomeLinerentProp = createIncomeLinerenDictHtml(App.getDictInfo(9080));
		incomeLinerentLable = createIncomeLinerenDictHtml(App.getDictInfo(9090));
		incomeLinerentCycle = createIncomeLinerenDictHtml(App.getDictInfo(9015));
	};
	function createIncomeLinerenDictHtml(data){
		var selectHtml = "<option value=''>请选择</option>";
		$.each(data, function(k,v) {
			selectHtml += "<option value='"+ k +"'>"+ v +"</option>";
		});
		return selectHtml;
	}
	
	/*
	 * 获取开票信息
	 */
	function getIncomeLinerenInfo() {
		var url = serverPath + "contractOrderEditorController/getLinerentId";
		var postData = JSON.stringify({wcardId:wcardId});
		App.formAjaxJson(url, "post", postData, successCallback);

		function successCallback(result) {
			var data = result.data;
			if(data.length > 0){
				if($("#incomeLinerentTbody .emptyTr")[0] != undefined){
					$("#incomeLinerentTbody .emptyTr").remove();
				};
				isCreateIncomeLinerentTrLength = data.length;
				for(var i = 0; i < data.length; i++){
					var productKind = "productKind" + i;
					var productName = "productName" + i;
					var productAttr = "productAttr" + i;
					var auditLabel = "auditLabel" + i;
					var fixedMonthRent = "fixedMonthRent" + i;
					var lineCount = "lineCount" + i;
					var totalMonthRent = "totalMonthRent" + i;
					var onceCost = "onceCost" + i;
					var otherCost = "otherCost" + i;
					var settlementFrequency = "settlementFrequency" + i;
					var appendHtml = "<tr data-id='"+ data[i].linerentId +"' class='"+ productName +"'>"+
										"<td class='lineChargesTableEdit'><label class='ui-checkbox'><input type='checkbox' name='incomeLinerentCheck'><span></span></label></td>"+
										"<td class='orderNumber'></td>"+
										"<td><div class='form-group'><select class='form-control select2me productKind' data-placeholder='请选择产品类型' name='"+ productKind +"'>"+ incomeLinerentType +"</select></div></td>"+
										"<td><div class='form-group'><select class='form-control select2me productName' data-placeholder='请选择产品名称' name='"+ productName +"'>"+ incomeLinerentName +"</select></div></td>"+
										"<td><div class='form-group'><select class='form-control select2me productAttr' data-placeholder='请选择产品属性' name='"+ productAttr +"'>"+ incomeLinerentProp +"</select></div></td>"+
										"<td><div class='form-group'><select class='form-control select2me auditLabel' data-placeholder='请选择稽核标签' name='"+ auditLabel +"'>"+ incomeLinerentLable +"</select></div></td>"+
										"<td><div class='form-group'><input type='text' class='form-control fixedMonthRent' name='"+ fixedMonthRent +"' placeholder='请输入固定月租' value='"+data[i].fixedMonthRent+"' maxlength='15' /></div></td>"+
										"<td><div class='form-group'><input type='text' class='form-control lineCount' name='"+ lineCount +"' placeholder='请输入线路数量' value='"+data[i].lineCount+"' maxlength='10'  /></div></td>"+
										"<td><div class='form-group'><input type='text' class='form-control totalMonthRent' name='"+ totalMonthRent +"' placeholder='请输入合计月租' value='"+data[i].totalMonthRent+"' maxlength='15' /></div></td>"+
										"<td><div class='form-group'><input type='text' class='form-control onceCost' name='"+ onceCost +"' placeholder='请输入一次性费用' value='"+data[i].onceCost+"' maxlength='15' /></div></td>"+
										"<td><div class='form-group'><input type='text' class='form-control otherCost' name='"+ otherCost +"' placeholder='请输入其他费用' value='"+data[i].otherCost+"' maxlength='15' /></div></td>"+
										"<td><div class='form-group'><select class='form-control select2me settlementFrequency' data-placeholder='请选择结算周期' name='"+ settlementFrequency +"'>"+ incomeLinerentCycle +"</select></div></td>"+
										"<td class='lineChargesTableEdit'><button type='button' class='btn primary btn-outline btn-xs' onclick='delectIncomeLinerentTr(this)'>删除</button></td>"+
									"</tr>";
					$("#incomeLinerentTbody").append(appendHtml);
					App.initFormSelect2("."+productName);
					$("select[name='"+productKind+"']").val(data[i].productKind).trigger("change");
					$("select[name='"+productName+"']").val(data[i].productName).trigger("change");
					$("select[name='"+productAttr+"']").val(data[i].productAttr).trigger("change");
					$("select[name='"+auditLabel+"']").val(data[i].auditLabel).trigger("change");
					$("select[name='"+settlementFrequency+"']").val(data[i].settlementFrequency).trigger("change");
					addNotEmptyValidatorField(productKind,"产品类型不能为空");
					addNotEmptyValidatorField(productName,"产品名称不能为空");
					addNotEmptyValidatorField(productAttr,"产品属性不能为空");
					addNotEmptyValidatorField(auditLabel,"稽核标签不能为空");
					addNotEmptyValidatorField(settlementFrequency,"结算周期不能为空");
					var isInteger = {
						notEmpty : {
							message : "输入项不能为空"
						},
						regexp : {
							regexp : /^(0|[1-9][0-9]*)$/,
							message : '请输入大于等于0的整数'
						}
					};
					var isMoney = {
						notEmpty : {
							message : "输入项不能为空"
						},
						regexp : {
							regexp : /^[0-9]{1,9}.{0,1}[0-9]{0,2}$/,
							message : '请输入正确的金额'
						}
					}
				   	App.addValidatorField("#workOrderContentForm",lineCount,isInteger);
				   	App.addValidatorField("#workOrderContentForm",fixedMonthRent,isMoney);
				   	App.addValidatorField("#workOrderContentForm",totalMonthRent,isMoney);
				   	App.addValidatorField("#workOrderContentForm",onceCost,isMoney);
				   	App.addValidatorField("#workOrderContentForm",otherCost,isMoney);
					addIncomeLinerentTableSort();
					App.checkAllFn("#incomeLinerentCheckAll","incomeLinerentCheck");
				};
			};
			/*
			 * isEdit 判断页面是否只能查看
			 */
			if(!isEdit){
				$("#lineChargesListContent").find("input,select").attr("disabled","disabled");
				$("#lineChargesListToolbar,.lineChargesTableEdit").remove();
			}else{
				$("#lineChargesListToolbar").removeClass("hidden");
			};
		}
	}
	/*
	 * 新增点击
	 */
	function addIncomeLinerentTr(){
		if($("#incomeLinerentTbody .emptyTr")[0] != undefined){
			$("#incomeLinerentTbody .emptyTr").remove();
		}
		isCreateIncomeLinerentTrLength++;
		var productKind = "productKind" + isCreateIncomeLinerentTrLength;
		var productName = "productName" + isCreateIncomeLinerentTrLength;
		var productAttr = "productAttr" + isCreateIncomeLinerentTrLength;
		var auditLabel = "auditLabel" + isCreateIncomeLinerentTrLength;
		var fixedMonthRent = "fixedMonthRent" + isCreateIncomeLinerentTrLength;
		var lineCount = "lineCount" + isCreateIncomeLinerentTrLength;
		var totalMonthRent = "totalMonthRent" + isCreateIncomeLinerentTrLength;
		var onceCost = "onceCost" + isCreateIncomeLinerentTrLength;
		var otherCost = "otherCost" + isCreateIncomeLinerentTrLength;
		var settlementFrequency = "settlementFrequency" + isCreateIncomeLinerentTrLength;
		var appendHtml = "<tr data-id='100000' class='"+ productName +"'>"+
							"<td><label class='ui-checkbox'><input type='checkbox' name='incomeLinerentCheck'><span></span></label></td>"+
							"<td class='orderNumber'></td>"+
							"<td><div class='form-group'><select class='form-control select2me productKind' data-placeholder='请选择产品类型' name='"+ productKind +"'>"+ incomeLinerentType +"</select></div></td>"+
							"<td><div class='form-group'><select class='form-control select2me productName' data-placeholder='请选择产品名称' name='"+ productName +"'>"+ incomeLinerentName +"</select></div></td>"+
							"<td><div class='form-group'><select class='form-control select2me productAttr' data-placeholder='请选择产品属性' name='"+ productAttr +"'>"+ incomeLinerentProp +"</select></div></td>"+
							"<td><div class='form-group'><select class='form-control select2me auditLabel' data-placeholder='请选择稽核标签' name='"+ auditLabel +"'>"+ incomeLinerentLable +"</select></div></td>"+
							"<td><div class='form-group'><input type='text' class='form-control fixedMonthRent' name='"+ fixedMonthRent +"' placeholder='请输入固定月租' maxlength='15' /></div></td>"+
							"<td><div class='form-group'><input type='text' class='form-control lineCount' name='"+ lineCount +"' placeholder='请输入线路数量' maxlength='10' /></div></td>"+
							"<td><div class='form-group'><input type='text' class='form-control totalMonthRent' name='"+ totalMonthRent +"' placeholder='请输入合计月租' maxlength='15' /></div></td>"+
							"<td><div class='form-group'><input type='text' class='form-control onceCost' name='"+ onceCost +"' placeholder='请输入一次性费用' value='0' maxlength='15' /></div></td>"+
							"<td><div class='form-group'><input type='text' class='form-control otherCost' name='"+ otherCost +"' placeholder='请输入其他费用' value='0' maxlength='15' /></div></td>"+
							"<td><div class='form-group'><select class='form-control select2me settlementFrequency' data-placeholder='请选择结算周期' name='"+ settlementFrequency +"'>"+ incomeLinerentCycle +"</select></div></td>"+
							"<td><button type='button' class='btn primary btn-outline btn-xs' onclick='delectIncomeLinerentTr(this)'>删除</button></td>"+
						"</tr>";
		$("#incomeLinerentTbody").append(appendHtml);
		App.initFormSelect2("."+productName);
		addNotEmptyValidatorField(productKind,"产品类型不能为空");
		addNotEmptyValidatorField(productName,"产品名称不能为空");
		addNotEmptyValidatorField(productAttr,"产品属性不能为空");
		addNotEmptyValidatorField(auditLabel,"稽核标签不能为空");
		addNotEmptyValidatorField(settlementFrequency,"结算周期不能为空");
		var isInteger = {
			notEmpty : {
				message : "输入项不能为空"
			},
			regexp : {
				regexp : /^(0|[1-9][0-9]*)$/,
				message : '请输入大于等于0的整数'
			}
		};
		var isMoney = {
			notEmpty : {
				message : "输入项不能为空"
			},
			regexp : {
				regexp : /^[0-9]{1,9}.{0,1}[0-9]{0,2}$/,
				message : '请输入正确的金额'
			}
		}
	   	App.addValidatorField("#workOrderContentForm",lineCount,isInteger);
	   	App.addValidatorField("#workOrderContentForm",fixedMonthRent,isMoney);
	   	App.addValidatorField("#workOrderContentForm",totalMonthRent,isMoney);
	   	App.addValidatorField("#workOrderContentForm",onceCost,isMoney);
	   	App.addValidatorField("#workOrderContentForm",otherCost,isMoney);
	   	addIncomeLinerentTableSort();
		App.checkAllFn("#incomeLinerentCheckAll","incomeLinerentCheck");
	}
	/*
	 * 批量删除表格数据
	 */
	function delectsIncomeLinerentTr(){
		var checkInvoiceLength = $("#incomeLinerentTbody input[name='incomeLinerentCheck']:checked").length;
		if(checkInvoiceLength == 0){
			layer.msg("请勾选要删除的线路资费清单");
		}else{
			layer.confirm("是否要删除这"+checkInvoiceLength+"条数据？",{icon:7,title:"提示"},function(index){
				layer.close(index);
				$.each($("#incomeLinerentTbody input[name='incomeLinerentCheck']:checked"), function(k,v) {
					$(v).parents("tr").remove();
				});
				addIncomeLinerentTableSort();
				App.checkAllFn("#incomeLinerentCheckAll","incomeLinerentCheck");
				addIncomeLinerentTbodyEmptyTr();
			})
		}
	}
	/*
	 * 删除表格数据
	 */
	function delectIncomeLinerentTr(dom){
		layer.confirm("是否要删除此条数据？",{icon:7,title:"提示"},function(index){
			layer.close(index);
			$(dom).parents("tr").remove();
			addIncomeLinerentTableSort();
			App.checkAllFn("#incomeLinerentCheckAll","incomeLinerentCheck");
			addIncomeLinerentTbodyEmptyTr();
		})
	}
	/*
	 * 表格数据增加序号
	 */
	function addIncomeLinerentTableSort(){
		$.each($("#incomeLinerentTbody .orderNumber"), function(k,v) {
			$(v).text(k+1);
		});
	}
	/*
	 * 若为空增加empty值
	 */
	function addIncomeLinerentTbodyEmptyTr(){
		if($("#incomeLinerentTbody tr").length == 0){
			var html = '<tr class="emptyTr"><td colspan="13">暂无线路资费清单</td></tr>';
			$("#incomeLinerentTbody").html(html);
		}
	}
</script>