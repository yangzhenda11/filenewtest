function serarchForDone(e){var t=$("#searchTableForDone").DataTable();e?t.ajax.reload(null,!1):t.ajax.reload()}function resetConditionForDone(){$("#processTitleForDone").val(""),$("#linkNameForDone").val(""),$("#startDateForDone").val(""),$("#endDateForDone").val("")}function handleTaskForDone(e,t,a,o,n,r,l,i,s){$("#taskIdForDone").val(e),$("#taskDefinitionKeyForDone").val(t),$("#nameForDone").val(a),$("#processInstanceIdForDone").val(o),$("#titleForDone").val(n),$("#processDefinitionIdForDone").val(r),$("#processDefinitionKeyForDone").val(l),$("#executionIdForDone").val(i),$("#assigneeIdForDone").val(s),$("#goTaskToDoDetailForDone").load("/html/workflow/taskdetail/task-hasdone.html"),$("#goTaskToDoDetailForDone").show(),$("#searchContentForDone").hide()}function getFlowKyeList(){$.ajax({cache:!0,type:"POST",url:serverPath+"workflowrest/getFlowKeyList",async:!1,error:function(){layer.msg("获取流程类型异常，请联系管理员!",{time:1e3})},success:function(e){var t=e.dataArray;console.log(e),$("#flowType").append("<option value=''>请选择流程类型</option>"),$.each(t,function(e,t){$("#flowType").append("<option value='"+t.value+"'>"+t.label+"</option>")})},error:function(e){App.ajaxErrorCallback(e)}})}var config=parent.globalConfig,serverPath=config.serverPath,curStaffOrgId=config.curStaffOrgId,curStaffId=config.curStaffId;$(function(){getFlowKyeList(),$("#currentIdForDone").val(curStaffOrgId)});var btnModel='    	{{#each func}}    <button type="button" class="btn primary btn-outline btn-xs {{this.type}}" {{this.title}} {{this.fn}}>{{this.name}}</button>    {{/each}}',template=Handlebars.compile(btnModel);App.initDataTables("#searchTableForDone","#submitBtn",{ajax:{type:"GET",url:serverPath+"workflowrest/taskHasDone",data:function(e){return e.title=$("#processTitleForDone").val(),e.completeTimeStart=$("#startDateForDone").val(),e.completeTimeEnd=$("#endDateForDone").val(),e.staffId=curStaffId,e.flowType=$("#flowType").val(),e.contractCode=$("#contractCode").val(),e}},columns:[{data:null,title:"序号",className:"text-center",render:function(e,t,a,o){var n=App.getDatatablePaging("#searchTableForDone").pageStart;return n+o.row+1}},{data:"title",title:"主题",className:"text-center whiteSpaceNormal",width:"33%"},{data:"processDefinitionName",title:"流程类型",className:"text-center whiteSpaceNormal",width:"17%"},{data:"endTime",title:"送出日期",className:"text-center whiteSpaceNormal",width:"15%",render:function(e){return getSmpFormatDateByLong(e,!0)}},{data:"nowLinkName",title:"当前环节",className:"text-center",width:"5%"},{data:"nowUserName",title:"当前处理人",className:"text-center",width:"5%"},{data:null,title:"操作",className:"text-center",width:"5%"}],columnDefs:[{targets:"_all",defaultContent:""},{targets:-1,render:function(e,t,a){var o=$("#currentIdForDone").val(),n=a.assignee,r="disabled",l="title=当前任务属于【"+a.staffOrgName+"】，请切换岗位后查看",i="";o==n&&(r="",l="",i="onclick=handleTaskForDone('"+a.id+"','"+a.taskDefinitionKey+"','"+a.name+"','"+a.processInstanceId+"','"+a.title+"','"+a.processDefinitionId+"','"+a.processDefinitionKey+"','"+a.executionId+"','"+a.assignee+"')");var s={func:[{name:"查看",title:l,fn:i,type:r}]},c=template(s);return c}}]});