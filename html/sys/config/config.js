function getConfigTable(){App.initDataTables("#configTable","#submitBtn",{ajax:{type:"GET",url:serverPath+"configs/",data:function(e){return e.code=$("#configCode").val(),e}},columns:[{data:null,title:"操作",className:"text-center",render:function(e,a,t){if(t){var o=new Array;return configUpdate&&o.push({name:"修改",fn:"editConfigModal('"+t.id+"')"}),configDelete&&o.push({name:"删除",fn:"delConfig('"+t.id+"','"+t.code+"')"}),App.getDataTableBtn(o)}return""}},{data:null,title:"参数名称",render:function(e,a,t){return'<a href="javascript:void(0)" onclick = "detailConfigModal(\''+t.id+"')\">"+t.code+"</a>"}},{data:"val",title:"参数值",render:$.fn.dataTable.render.ellipsis(22,!0)},{data:"attra",title:"允许用户更改",render:function(e){return 0==e?"否":"是"}},{data:"attrb",title:"可更改枚举值",render:$.fn.dataTable.render.ellipsis(40,!0)}]})}function searchConfig(e){var a=$("#configTable").DataTable();e?a.ajax.reload(null,!1):a.ajax.reload()}function detailConfigModal(e){$("#modal").load("_configModal.html?"+App.timestamp()+" #modalDetail",function(){getConfig(e,"detail")})}function addConfigModal(){$("#modal").load("_configModal.html?"+App.timestamp()+" #modalEdit",function(){$("#modalTitle").text("新增系统参数"),$("#modal").modal("show"),App.initFormSelect2("#configForm"),validate("add")})}function editConfigModal(e){$("#modal").load("_configModal.html?"+App.timestamp()+" #modalEdit",function(){$("#modalTitle").text("系统参数修改"),App.initFormSelect2("#configForm"),getConfig(e,"edit"),validate("edit")})}function getConfig(e,a){function t(e){var t=e.sysConfig;if("edit"==a)$("#modal").modal("show"),App.setFormValues("#configForm",t);else{$("#modal").modal("show"),$("#codeDetail").text(t.code);var o={attra:function(e){return"0"==e?"否":"是"}};App.setFindValue("#configInfo",t,o)}}App.formAjaxJson(serverPath+"configs/"+e,"get","",t)}function delConfig(e,a){layer.confirm('确定删除系统参数<span style="color:red;margin:0 5px;">'+a+"</span>?",{icon:3,title:"删除系统参数"},function(a){function t(){layer.close(a),layer.msg("删除成功"),searchConfig(!0)}App.formAjaxJson(serverPath+"configs/"+e,"DELETE","",t)})}function updateConfig(e){function a(){layer.msg(n),searchConfig(!0),$("#modal").modal("hide")}function t(){$("#configForm").data("bootstrapValidator").resetForm()}var o=App.getFormValues($("#configForm")),n="新增成功",i=serverPath+"configs/",l="POST";"add"==e?delete o.id:(n="修改成功",i=serverPath+"configs/"+o.id,l="PUT"),App.formAjaxJson(i,l,JSON.stringify(o),a,t)}function validate(e){$("#configForm").bootstrapValidator({live:"enabled",trigger:"live focus blur keyup change",message:"校验未通过",container:"popover",fields:{code:{validators:{notEmpty:{message:"请输入参数名称"}}},val:{validators:{notEmpty:{message:"请输入参数值"}}},attra:{validators:{notEmpty:{message:"请选择允许用户更改"}}}}}).on("success.form.bv",function(a){a.preventDefault(),updateConfig(e)})}var config=parent.globalConfig,serverPath=config.serverPath;$(function(){parent.data_permFilter(document),getConfigTable()});var configUpdate=parent.data_tpFilter("sys:config:update"),configDelete=parent.data_tpFilter("sys:config:delete");