<link rel="stylesheet" type="text/css" href="../../../static/css/iconfont/iconfont.css" />
<link rel="stylesheet" type="text/css" href="../../../static/plugins/datatables/datatables.min.css" />
<style type="text/css">
	#contractDataTable .radioCheck{
		position: relative;
	}
	#contractDataTable .radioCheck .ui-radio {
		position: absolute;
		top: 50%;
		left: 50%;
		padding-left: 20px;
		margin-top: -10px;
		margin-left: -10px;
	}
</style>
<div class="modal-dialog" role="document" style="width: 68%;">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="myModalLabel">合同查询</h4>
		</div>
		<div class="modal-body">
			<div class="portlet-body">
				<div class="page-search">
					<div class="row page-search-form">
						<div class="col-sm-4">
							<div class="input-group">
								<span class="input-group-addon searchLableText">合同名称</span>
								<input type="text" class="form-control" name="contractName" >
							</div>
						</div>
						<div class="col-sm-4">
							<div class="input-group">
								<span class="input-group-addon searchLableText">合同编号</span>
								<input type="text" class="form-control" name="contractNumber" >
							</div>
						</div>
						<div class="input-group">
							<button type="button" id="searchBtnM" class="btn btn-block red" data-loading-text="加载中.." onclick="searchContractData();"><i class="iconfont icon-search"></i> 查询</button>
						</div>
					</div>
				</div>
				<table id="contractDataTable" class="table table-striped table-bordered table-hover table-header-fixed"></table>
			</div>
		</div>
		<div class="modal-footer">
			<button type="button" onclick="checkContractData()" class="btn btn-danger btn-circle"><i class="iconfont icon-baocun"></i> 确定</button>
			<button type="button" class="btn btn-default btn-circle" data-dismiss="modal"><i class="iconfont icon-close"></i> 关闭</button>
		</div>
	</div>
</div>
<script src="../../../static/plugins/datatables/datatables.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../static/plugins/datatables/ellipsis.js"></script>
<script type="text/javascript">
	//系统全局变量获取
	var config = top.globalConfig;
	var serverPath = config.serverPath;
	var setDom = null;
	//初始化表格
	function initContractDataSearch(dom, textValue, setKey, ajaxData) {
		$("#commomModal").modal("show");
		$('#commomModal').on('shown.bs.modal', function (e) {
			getContractData(dom, textValue, setKey, ajaxData);
		})
	}
	
	function getContractData(dom, textValue, setKey, ajaxData) {
		setDom = dom;
		App.initDataTables('#contractDataTable', "#searchBtnM", {
			ajax: {
				"type": "post",
				"contentType": "application/json",
				"url": serverPath + 'contractBaseInfo/listContractByUndertakerId',
				"data": function(d) {
					d.contractName = $("input[name='contractName']").val().trim();
					d.contractNumber = $("input[name='contractNumber']").val().trim();
					var parm = $.extend({}, ajaxData, d);
					return JSON.stringify(parm);
				}
			},
			"columns": [{
					"data": textValue,
					"className": "text-center radioCheck",
					"title": "操作",
					"render": function(data, type, full, meta) {
						var radioHtml = "<label class='ui-radio'><input type='radio' value = '" + data + "' name='checkRadio'><span></span></label>";
						return radioHtml;
					}
				},
				{
					"data": "contractName",
					"title": "合同名称",
					"className":"whiteSpaceNormal",
					"width":"35%"
				},
				{
					"data": "contractNumber",
					"title": "合同编号"
				},
				{
					"data": "partyName",
					"title": "对方主体名称"
				}
			]
		});
		//行点击事件  
		$('#contractDataTable tbody').on('click', 'tr', function() {
			$(this).find("input[name='checkRadio']").prop("checked", true);
			//获取选择行的内容
			var data = $('#contractDataTable').DataTable().row(this).data();
			if(setKey != undefined){
				if($.isArray(setKey)){
					$.each(setKey, function(k,v) {
						$(dom).data(v,data[v]);
					});
				}else{
					$(dom).data(setKey,data[setKey]);
				}
			};
		});
	}
	//搜索点击事件
	function searchContractData() {
		var table = $('#contractDataTable').DataTable();
		table.ajax.reload();
	}
	//点击确定页面dom元素选择值
	function checkContractData() {
		var checkValue = $("#contractDataTable").find("input[name='checkRadio']:checked").val();
		$(setDom).val(checkValue);
		$(setDom).data("exactSearch",true);
		$("#commomModal").modal("hide");
	}
</script>