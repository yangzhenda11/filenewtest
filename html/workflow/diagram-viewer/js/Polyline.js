function Anchor(t,i,s,e){this.uuid=t,this.x=s,this.y=e,this.type=i==ANCHOR_TYPE.middle?ANCHOR_TYPE.middle:ANCHOR_TYPE.main}function Polyline(t,i,s){this.points=i,this.path=[],this.anchors=[],s&&(this.strokeWidth=s),this.closePath=!1,this.init()}function Polygone(t,i){this.points=t,this.path=[],this.anchors=[],i&&(this.strokeWidth=i),this.closePath=!0,this.init()}var ANCHOR_TYPE={main:"main",middle:"middle",first:"first",last:"last"};Anchor.prototype={uuid:null,x:0,y:0,type:ANCHOR_TYPE.main,isFirst:!1,isLast:!1,ndex:0,typeIndex:0},Polyline.prototype={id:null,points:[],path:[],anchors:[],strokeWidth:1,radius:15,showDetails:!1,element:null,isDefaultConditionAvailable:!1,closePath:!1,init:function(){var t=this.getLinesCount();if(!(1>t)){this.normalizeCoordinates(),this.pushAnchor(ANCHOR_TYPE.first,this.getLine(0).x1,this.getLine(0).y1);for(var i=1;t>i;i++){{var s=this.getLine(i-1);this.getLine(i)}this.pushAnchor(ANCHOR_TYPE.main,s.x2,s.y2)}this.pushAnchor(ANCHOR_TYPE.last,this.getLine(t-1).x2,this.getLine(t-1).y2),this.rebuildPath()}},normalizeCoordinates:function(){for(var t=0;t<this.points.length;t++)this.points[t].x=parseFloat(this.points[t].x),this.points[t].y=parseFloat(this.points[t].y)},getLinesCount:function(){return this.points.length-1},_getLine:function(t){return{x1:this.points[t].x,y1:this.points[t].y,x2:this.points[t+1].x,y2:this.points[t+1].y}},getLine:function(t){var i=this._getLine(t);return i.angle=this.getLineAngle(t),i},getLineAngle:function(t){var i=this._getLine(t);return Math.atan2(i.y2-i.y1,i.x2-i.x1)},getLineLengthX:function(t){var i=this.getLine(t);return i.x2-i.x1},getLineLengthY:function(t){var i=this.getLine(t);return i.y2-i.y1},getLineLength:function(t){this.getLine(t);return Math.sqrt(Math.pow(this.getLineLengthX(t),2)+Math.pow(this.getLineLengthY(t),2))},getAnchors:function(){return this.anchors},getAnchorsCount:function(t){if(t){for(var i=0,s=0;s<this.getAnchorsCount();s++){var e=this.anchors[s];e.getType()==t&&i++}return i}return this.anchors.length},pushAnchor:function(t,i,s,e){if(t==ANCHOR_TYPE.first)e=0,typeIndex=0;else if(t==ANCHOR_TYPE.last)e=this.getAnchorsCount(),typeIndex=0;else if(e)for(var n=0;n<this.getAnchorsCount();n++){var h=this.anchors[n];h.index>e&&(h.index++,h.typeIndex++)}else e=this.anchors.length;var h=new Anchor(this.id,ANCHOR_TYPE.main,i,s,e,typeIndex);this.anchors.push(h)},getAnchor:function(t){return this.anchors[t]},getAnchorByType:function(t,i){if(t==ANCHOR_TYPE.first)return this.anchors[0];if(t==ANCHOR_TYPE.last)return this.anchors[this.getAnchorsCount()-1];for(var s=0;s<this.getAnchorsCount();s++){var e=this.anchors[s];if(e.type==t&&i==e.position)return e}return null},addNewPoint:function(t,i,s){for(var e=0;e<this.getLinesCount();e++){var n=this.getLine(e);if(i>n.x1&&i<n.x2&&s>n.y1&&s<n.y2){this.points.splice(e+1,0,{x:i,y:s});break}}this.rebuildPath()},rebuildPath:function(){for(var t=[],i=0;i<this.getAnchorsCount();i++){var s=this.getAnchor(i),e="";e=0==i?"M":"L";var n=s.x,h=s.y;if(i>0&&i<this.getAnchorsCount()-1){var r=s.x,o=s.y,a=this.getLineLength(i-1);a<this.radius&&(a=this.radius),this.isDefaultConditionAvailable=this.isDefaultConditionAvailable||1==i&&a>10;var l=this.getLineLengthY(i-1)*this.radius/a,g=this.getLineLengthX(i-1)*this.radius/a;n=s.x-g,h=s.y-l,a<2*this.radius&&i>1&&(n=s.x-this.getLineLengthX(i-1)/2,h=s.y-this.getLineLengthY(i-1)/2);var a=this.getLineLength(i);a<this.radius&&(a=this.radius);var l=this.getLineLengthY(i)*this.radius/a,g=this.getLineLengthX(i)*this.radius/a,u=s.x+g,c=s.y+l;a<2*this.radius&&i<this.getAnchorsCount()-2&&(u=s.x+this.getLineLengthX(i)/2,c=s.y+this.getLineLengthY(i)/2);var p=(r-n)/3,d=(o-h)/3,f=r-p,L=o-d,y=(r-u)/3,C=(o-c)/3,A=r-y,v=o-C,P=u,x=c;if(this.showDetails){ProcessDiagramCanvas.g.path("M"+n+","+h+"L"+f+","+L).attr({stroke:Color.get(255,153,51),"stroke-dasharray":"- "}),ProcessDiagramCanvas.g.path("M"+u+","+c+"L"+A+","+v).attr({stroke:Color.get(255,153,51),"stroke-dasharray":"- "}),ProcessDiagramCanvas.g.ellipse(f,L,2,2).attr({stroke:Color.SlateGrey}),ProcessDiagramCanvas.g.ellipse(A,v,2,2).attr({stroke:Color.SlateGrey}),ProcessDiagramCanvas.g.ellipse(r,o,this.radius,this.radius).attr({stroke:Color.Gainsboro}),ProcessDiagramCanvas.g.ellipse(n,h,2,2).attr({fill:Color.red}),ProcessDiagramCanvas.g.ellipse(u,c,2,2).attr({fill:Color.red})}}else if(1==i&&2==this.getAnchorsCount()){var a=this.getLineLength(i-1);a<this.radius&&(a=this.radius),this.isDefaultConditionAvailable=this.isDefaultConditionAvailable||1==i&&a>10}this.strokeWidth%2==1&&(n+=.5,h+=.5),t.push([e,n,h]),i>0&&i<this.getAnchorsCount()-1&&t.push(["C",f,L,A,v,P,x])}this.closePath&&(console.log("closePath:",this.closePath),t.push(["Z"])),this.path=t},transform:function(t){this.element.transform(t)},attr:function(t){this.element.attr(t)}};var Foo=function(){};Foo.prototype=Polyline.prototype,Polygone.prototype=new Foo,Polygone.prototype.rebuildPath=function(){for(var t=[],i=0;i<this.getAnchorsCount();i++){var s=this.getAnchor(i),e="";e=0==i?"M":"L";var n=s.x,h=s.y;this.strokeWidth%2==1&&(n+=.5,h+=.5),t.push([e,n,h])}this.closePath&&t.push(["Z"]),this.path=t};