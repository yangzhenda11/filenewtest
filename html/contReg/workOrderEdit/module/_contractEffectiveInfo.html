<div class="form-fieldset">
	<div class="form-fieldset-title">
		<span><i class="iconfont icon-layers"></i> 合同生效信息</span>
		<div class="form-fieldset-tools">
			<a href="#" class="form-collapse"><i class="fa fa-angle-up"></i></a>
		</div>
	</div>
	<div class="form-fieldset-body">
		<div class="row defaultFieldsetForm" id="validityForm">
			<div class="portlet" id="undertakerCommitmentContent">
                <div class="portlet-body form">
                    <p class="margin-top-10">承办人确认信息：</p>
					<div>
						<label class="ui-checkbox">
							<input type="checkbox" value="1" name="undertakerCommitment">
							<span></span>
							<i class="iconfont icon-mi required"></i>
							各方均已签字盖章，签字盖章的合同文本与系统内最终审批的合同文本一致。
						</label>
					</div>
            	</div>
       	    </div>
       	    <div class="portlet hidden" id="adminCommitmentContent">
                <div class="portlet-body form">
                    <p class="margin-top-10">合同管理员确认信息：</p>
					<div>
						<label class="ui-checkbox">
							<input type="checkbox" value="1" name="adminCommitment">
							<span></span>
							<i class="iconfont icon-mi required"></i>
							本人确认已收到经各方签字盖章完毕的纸质合同文本，并确认系统内的签订盖章日期与合同文本内的签订盖章日期一致。
						</label>
					</div>
            	</div>
       	    </div>
       	    <input type="hidden" name="validityId" id="validityId" value="100000" />
			<div class="col-sm-6 form-group">
				<label for="partyASignDate" class="control-label"><i class="iconfont icon-mi required"></i>我方签约日期：</label>
				<div class="valiParent input-group">
					<input type="text" name="partyASignDate" id="partyASignDate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" class="form-control" readonly="readonly" />
					<span class="input-group-addon"><i class="iconfont icon-calendar"></i></span>
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="partyZSignDate" class="control-label"><i class="iconfont icon-mi required"></i>对方签约日期：</label>
				<div class="valiParent input-group">
					<input type="text" name="partyZSignDate" id="partyZSignDate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" class="form-control" readonly="readonly" />
					<span class="input-group-addon"><i class="iconfont icon-calendar"></i></span>
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="periodType" class="control-label"><i class="iconfont icon-mi required"></i>合同有效期确认方式：</label>
				<div class="valiParent">
					<select class="form-control select2me" data-placeholder='请选择合同有效期确认方式' data-allowClear="false" name="periodType" id="periodType">
						<option value="905010">固定起止日期</option>
						<option value="905020">按条件约定合同生效日期，期限固定</option>
						<option value="905030">按条件约定合同生效日期，期限不固定</option>
					</select>
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="isPostponable" class="control-label"><i class="iconfont icon-mi required"></i>是否顺延：</label>
				<div class="valiParent">
					<div class="ui-radio-list ui-radio-inline">
						<label class="ui-radio">
							是
							<input type="radio" value="1" name="isPostponable">
							<span></span>
						</label>
						<label class="ui-radio">
							否
							<input type="radio" value="0" checked="checked" name="isPostponable">
							<span></span>
						</label>
					</div>
				</div>
			</div>
			<div id="postponableValidator">
				<div class="col-sm-6 form-group hidden" id="effectiveDateDiv">
					<label for="effectiveDate" class="control-label"><i class="iconfont icon-mi required"></i>生效日期：</label>
					<div class="valiParent input-group">
						<input type="text" name="effectiveDate" id="effectiveDate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" class="form-control" readonly="readonly" />
						<span class="input-group-addon"><i class="iconfont icon-calendar"></i></span>
					</div>
				</div>
				<div class="col-sm-6 form-group hidden" id="expiryDateDiv">
					<label for="expiryDate" class="control-label"><i class="iconfont icon-mi required"></i>终止日期：</label>
					<div class="valiParent input-group">
						<input type="text" name="expiryDate" id="expiryDate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" class="form-control" readonly="readonly" />
						<span class="input-group-addon"><i class="iconfont icon-calendar"></i></span>
					</div>
				</div>
				<div class="col-sm-6 form-group hidden" id="effectConditionDiv">
					<label for="effectCondition" class="control-label"><i class="iconfont icon-mi required"></i>生效条件：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="effectCondition" name="effectCondition" maxlength="2000" />
					</div>
				</div>
				<div class="col-sm-6 form-group hidden" id="effectPeriodDiv">
					<label for="effectPeriod" class="control-label"><i class="iconfont icon-mi required"></i>协议期限：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="effectPeriod" name="effectPeriod" maxlength="2000" />
					</div>
				</div>
				<div class="col-sm-6 form-group hidden" id="postponeConditionDiv">
					<label for="postponeCondition" class="control-label"><i class="iconfont icon-mi required"></i>顺延条件：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="postponeCondition" name="postponeCondition" maxlength="2000" />
					</div>
				</div>
				<div class="col-sm-6 form-group hidden" id="postponePeriodDiv">
					<label for="postponePeriod" class="control-label"><i class="iconfont icon-mi required"></i>顺延时限：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="postponePeriod" name="postponePeriod" maxlength="2000" />
					</div>
				</div>
				<div class="col-sm-6 form-group hidden" id="expiryConditionDiv">
					<label for="expiryCondition" class="control-label"><i class="iconfont icon-mi required"></i>满足终止：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="expiryCondition" name="expiryCondition" maxlength="2000" />
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	/*
	 * 设置页面的id值，由保存和提交后回调
	 */
	function setPageId_validityId(value){
		$("#validityId").val(value);
	}

	/*
	 * 返回本页面数据，若无返回{}，若不提交本页面的值可删除此方法
	 * isSubmit 提交时为true,判断页面是否要加逻辑上的验证(bootstrap-validator验证除外)
	 */
	function getValue_validity(isSubmit){
		var validityData = App.getFormValues($("#validityForm"));
		var undertakerCommitmentValue = $("input[name='undertakerCommitment']:checked").val();
		var adminCommitmentValue = $("input[name='adminCommitment']:checked").val();
		validityData.wcardId = wcardId;
		validityData.contractNumber = contractNumber;
		if(undertakerCommitmentValue == 1){
			validityData.undertakerCommitment = 1;
		}else{
			validityData.undertakerCommitment = 0;
		};
		if(adminCommitmentValue == 1){
			validityData.adminCommitment = 1;
		}else{
			validityData.adminCommitment = 0;
		};
		if(isSubmit && validityData.undertakerCommitment == 0){
			layer.msg("请勾选承办人确认信息!");
			srolloOffect("#undertakerCommitmentContent");
			return false;
		}else{
			return validityData;
		}
	}
	//设置默认展示方式
	changePostponableValidatorStatus(905010,0);
	//获取合同生效信息
	getvalidityData();
	/*
	 * 获取合同生效信息
	 */
	function getvalidityData(){
		var url = serverPath + "contractOrderEditorController/getValidityId";
		var postData = JSON.stringify({wcardId:wcardId});
		App.formAjaxJson(url, "post", postData, successCallback);
		function successCallback(result) {
			var data = result.data;
			if(data){
				changePostponableValidatorStatus(data.periodType,data.isPostponable);
				$("#periodType").val(data.periodType).trigger('change');
				if(data.isPostponable == 0){
					$("input[name='isPostponable'][value=0]").prop("checked",true);
				}else{
					$("input[name='isPostponable'][value=1]").prop("checked",true);
				};
				App.setFormValues("#validityForm",data);
				if($("input[name='adminCommitment']:checked").val()){
					if(parm.taskDefinitionKey == "GDQR" && parm.taskFlag == "yb"){
						$("#adminCommitmentContent").removeClass("hidden");
					}
				}
				/*
				 * isEdit 判断页面是否只能查看
				 * 逻辑1.当为工单确认为待办时显示
				 * 2.当为工单确认为已办时 勾选时显示
				 */
				if(!isEdit){
					$("#validityForm").find("input,select").attr("disabled","disabled");
					if(App.IEVersionVA11()){
						App.initFormSelect2("#validityForm");
					}
				};
				if(parm.taskDefinitionKey == "GDQR" && parm.taskFlag == "db"){
					$("#adminCommitmentContent").removeClass("hidden");
					if(fileUploadEdit == true){
						$("input[name='adminCommitment']").attr("disabled",false);
					}
				}
			}
		}
	}
	/*
	 * 选择触发input框改变
	 */
	$("#periodType").on("change",function(){
		if($(this).val() == "905030"){
			$("input[name='isPostponable'][value=0]").prop("checked",true);
		};
		var selectValue = $(this).val();
		var checkValue = $("input[name='isPostponable']:checked").val();
		changePostponableValidatorStatus(selectValue,checkValue);
		resetEffectiveValidator();
	});
	$("input[name='isPostponable']").on("change",function(){
		var selectValue = $("#periodType").val();
		var checkValue = $(this).val();
		changePostponableValidatorStatus(selectValue,checkValue);
		resetEffectiveValidator();
	});
	/*
	 * 选择时重置验证
	 */
	function resetEffectiveValidator(){
		$("#workOrderContentForm").data("bootstrapValidator").updateStatus("effectiveDate", "NOT_VALIDATED", null );
		$("#workOrderContentForm").data("bootstrapValidator").updateStatus("expiryDate", "NOT_VALIDATED", null );
		$("#workOrderContentForm").data("bootstrapValidator").updateStatus("effectCondition", "NOT_VALIDATED", null );
		$("#workOrderContentForm").data("bootstrapValidator").updateStatus("effectPeriod", "NOT_VALIDATED", null );
		$("#workOrderContentForm").data("bootstrapValidator").updateStatus("postponeCondition", "NOT_VALIDATED", null );
		$("#workOrderContentForm").data("bootstrapValidator").updateStatus("postponePeriod", "NOT_VALIDATED", null );
		$("#workOrderContentForm").data("bootstrapValidator").updateStatus("expiryCondition", "NOT_VALIDATED", null );
	}
	/*
	 *	有效期和是否顺延现实和隐藏
	 */
	function changePostponableValidatorStatus(selectValue,checkValue){
		$("#postponableValidator .form-group").addClass("hidden");
		$("#postponableValidator input").val("");
		if(selectValue == "905030"){
			$("input[name='isPostponable'][value=1]").prop("disabled",true);
		}else{
			$("input[name='isPostponable'][value=1]").prop("disabled",false);
		};
		if(selectValue == "905010" && checkValue == "1"){
			$("#effectiveDateDiv,#expiryDateDiv,#postponeConditionDiv,#postponePeriodDiv").removeClass("hidden");
		}else if(selectValue == "905010" && checkValue == "0"){
			$("#effectiveDateDiv,#expiryDateDiv").removeClass("hidden");
		}else if(selectValue == "905020" && checkValue == "1"){
			$("#effectConditionDiv,#effectPeriodDiv,#postponeConditionDiv,#postponePeriodDiv").removeClass("hidden");
		}else if(selectValue == "905020" && checkValue == "0"){
			$("#effectConditionDiv,#effectPeriodDiv").removeClass("hidden");
		}else if(selectValue == "905030" && checkValue == "0"){
			$("#effectConditionDiv,#expiryConditionDiv").removeClass("hidden");
		}
	}
	/*
	 * 必填校验
	 */
	addNotEmptyValidatorField("partyASignDate","我方签约日期不能为空");
	addNotEmptyValidatorField("partyZSignDate","对方签约日期不能为空");
	addNotEmptyValidatorField("effectiveDate","生效日期不能为空");
	addNotEmptyValidatorField("expiryDate","终止日期不能为空");
	addNotEmptyValidatorField("effectCondition","请输入不超过2000个字符的生效条件");
	addNotEmptyValidatorField("effectPeriod","请输入不超过2000个字符的协议期限");
	addNotEmptyValidatorField("postponeCondition","请输入不超过2000个字符的顺延条件");
	addNotEmptyValidatorField("postponePeriod","请输入不超过2000个字符的顺延时限");
	addNotEmptyValidatorField("expiryCondition","请输入不超过2000个字符的满足终止条件");
</script>