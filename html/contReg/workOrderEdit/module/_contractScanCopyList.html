<div class="form-fieldset">
	<div class="form-fieldset-title">
		<div class="fieldset-title">
			<p>合同扫描件列表</p><span></span>
		</div>
		<div class="form-fieldset-tools">
			<a class="form-collapse"><i class="fa fa-angle-up"></i></a>
		</div>
	</div>
	<div class="form-fieldset-body">
		<div class="portlet">
            <div class="portlet-title ">
                <div class="caption font-dark contract">
                    <span class="caption-subject bold uppercase">合同正文扫描件</span>
                </div>
            </div>
            <div class="portlet-body">
                <table class='table table-hover table-bordered table-striped table-align'>
					<thead>
						<tr>
							<th>序号</th>
							<th>文件列表</th>
							<th>上传日期</th>
							<th>上传人</th>
						</tr>
					</thead>
					<tbody id="contractMainTextTbody">
						<tr><td colspan="4">暂无合同正文扫描件信息</td></tr>
					</tbody>
				</table>
        	</div>
   	    </div>
   	    <div class="portlet">
            <div class="portlet-title ">
                <div class="caption font-dark contract">
                    <span class="caption-subject bold uppercase">合同附件扫描件</span>
                </div>
            </div>
            <div class="portlet-body">
                <table class='table table-hover table-bordered table-striped table-align'>
					<thead>
						<tr>
							<th>序号</th>
							<th>文件列表</th>
							<th>上传日期</th>
							<th>上传人</th>
						</tr>
					</thead>
					<tbody id="contractAttachmentDocTbody">
						<tr><td colspan="4">暂无合同附件扫描件信息</td></tr>
					</tbody>
				</table>
        	</div>
   	    </div>
	</div>
</div>
<script type="text/javascript">
	//获取合同扫描件ID来获取合同扫描件
	getContractScandocId()
	
	/*
	 * 获取合同扫描件ID来获取合同扫描件
	 */
	function getContractScandocId(){
		var url = serverPath + 'contractOrderEditorController/getScanningID';
		var postData = {
			contractId : contractId
		}
		App.formAjaxJson(url, "get", postData, successCallback);
		function successCallback(result) {
			var scandocId = result.data.scandocId;
			if(scandocId){
				//获取合同正文和附件列表
				getReplenishContractInfo(scandocId);
			}else{
				layer.msg("获取合同扫描件主键ID失败");
			}
		}
	}
	/*
	 * 获取合同正文和附件列表
	 */
	function getReplenishContractInfo(scandocId){
		var url = serverPath + "contractUpload/getReplenishContractInfo";
		var postData = {id:scandocId};
		App.formAjaxJson(url, "post", JSON.stringify(postData), successCallback);
		function successCallback(result) {
			var data = result.data;
			if(data){
				//设置正文扫描件html
				setBodyDocDataList(data.bodyDoc);
				//设置附件扫描件html
				setAttachDocDataList(data.attachDoc);
			}else{
				layer.msg("暂无数据");
			}
		}
	}
	/*
	 * 设置正文扫描件html
	 */
	function setBodyDocDataList(bodyDocData){
		if(bodyDocData){
			var html = "<tr><td>1</td>";
			if(bodyDocData.bodyDocStoreId){
				html += '<td><a onclick="openOnlineView(\''+bodyDocData.bodyDocStoreId+'\',\''+bodyDocData.displayName+'\')">'+ bodyDocData.displayName+'</a></td>';
//				html += "<td><a href='"+serverPath+"fileload/downloadS3?key="+bodyDocData.bodyDocStoreId+"'>"+ bodyDocData.displayName+"</td>";
			}else{
				html += "<td>"+ bodyDocData.displayName+"</td>";
			};
			html += "<td>"+ App.formatDateTime(bodyDocData.updatedDate,"yyyy-MM-dd") +"</td>"+
					"<td>"+ (bodyDocData.updatedByName == null ? "":bodyDocData.updatedByName) +"</td></tr>";
			
			$("#contractMainTextTbody").html(html);
		}else{
			layer.msg("获取不到合同正文扫描件信息");
			$("#contractTextUploadBtn").attr("disabled","disabled");
		}
	}
	/*
	 * 设置附件扫描件html
	 */
	function setAttachDocDataList(data){
		if(data.length > 0){
			var html = "";
			for(var i = 0; i < data.length; i++){
				html += "<tr>"+"<td>"+ (i+1) +"</td>";
				if(data[i].bodyDocStoreId){
					html += '<td><a onclick="openOnlineView(\''+data[i].bodyDocStoreId+'\',\''+data[i].displayName+'\')">'+ data[i].displayName+'</a></td>';
//					html += "<td><a href='"+serverPath+"fileload/downloadS3?key="+data[i].bodyDocStoreId+"'>"+ data[i].displayName+"</td>";
				}else{
					html += "<td>"+ data[i].displayName+"</td>";
				};
				html += "<td>"+ App.formatDateTime(data[i].updatedDate,"yyyy-MM-dd") +"</td>"+
						"<td>"+ (data[i].updatedByName == null ? "":data[i].updatedByName) +"</td></tr>";
			}
			$("#contractAttachmentDocTbody").html(html);
		}
	}
</script>