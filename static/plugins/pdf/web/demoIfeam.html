<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Document</title>
		<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
		<style type="text/css">
			html,
			body {
				height: 100%;
			}
			.hidden{
				display: none;
			}
		</style>
	</head>

	<body>
		<iframe id="iframe1" src="" style="width: 40%;height: 90%;"></iframe>
		<iframe id="iframe2" src="" style="width: 40%;height: 90%;"></iframe>
		<div id="" style="float: right;width: 18%;">
			<button onclick="webViewerFirstPage()">首页</button>
			<button onclick="webViewerPreviousPage()">上一页</button>
			<button onclick="webViewerNextPage()">下一页</button>
			<button onclick="webViewerLastPage()">尾页</button>
			<button onclick="webViewerZoomIn()">放大</button>
			<button onclick="webViewerZoomOut()">缩小</button>
			<select id="scaleSelect" title="" tabindex="23" data-l10n-id="zoom">
	            <option id="pageAutoOption" title="" value="auto" selected="selected" data-l10n-id="page_scale_auto">自动缩放</option>
	            <option id="pageActualOption" title="" value="page-actual" data-l10n-id="page_scale_actual">实际大小</option>
	            <option id="pageFitOption" title="" value="page-fit" data-l10n-id="page_scale_fit">适合页面</option>
	            <option id="pageWidthOption" title="" value="page-width" data-l10n-id="page_scale_width">适合页宽</option>
	            <option id="customScaleOption" title="" value="custom">自定义</option>
	            <option title="" value="0.5" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 50 }'>50%</option>
	            <option title="" value="0.75" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 75 }'>75%</option>
	            <option title="" value="1" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 100 }'>100%</option>
	            <option title="" value="1.25" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 125 }'>125%</option>
	            <option title="" value="1.5" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 150 }'>150%</option>
	            <option title="" value="2" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 200 }'>200%</option>
	            <option title="" value="3" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 300 }'>300%</option>
	            <option title="" value="4" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 400 }'>400%</option>
          	</select>
          	<div id="customScale" class="hidden">
          		<input type="text" id="scalevalue" value="" />
          		<button onclick="customScale()">确定</button>
          	</div>
          	<button onclick="webViewerPrint()">打印</button>
          	<button onclick="webViewerDownload()">下载</button>
          	<br />
          	<input type="text" name="search" id="search" value="" />
          	<button onclick="searchPrevious()">上一个</button>
          	<button onclick="searchNext()">下一个</button>
          	<button onclick="search()">搜索</button>
          	<table id="table" border="" cellspacing="" cellpadding="">
          		<tr><th>序号</th><th>合同正文</th><th>扫描件</th></tr>
          		<tr><td>1</td><td data-page="3">质量监督管理办法</td><td data-page="3">中国联通客户服务标准</td></tr>
          	</table>
          	<input type="checkbox" name="synchro" id="synchro" checked="checked" value="" /><label for="synchro">同步滚动模式</label>
		</div>
		
		<script type="text/javascript">
			var srcollFlag = null;
			$("#synchro").on("click",function(){
				if($(this).is(':checked')){
					if(srcollFlag == 1){
						var viewer2scrollTop = $('#iframe1').contents().find('#viewerContainer').scrollTop()/$('#iframe1').contents().find('#viewer').height()*$('#iframe2').contents().find('#viewer').height();
			    		$('#iframe2').contents().find('#viewerContainer').scrollTop(viewer2scrollTop);
					}else if(srcollFlag == 2){
						var viewer1scrollTop = $('#iframe2').contents().find('#viewerContainer').scrollTop()/$('#iframe2').contents().find('#viewer').height()*$('#iframe1').contents().find('#viewer').height();
			    		$('#iframe1').contents().find('#viewerContainer').scrollTop(viewer1scrollTop);
					}
					$('#iframe1').contents().find('#viewerContainer').on("scroll", function(){
						iframe1Scroll();
					});
					$('#iframe2').contents().find('#viewerContainer').on("scroll", function(){
						iframe2Scroll();
					});
				}else{
					$('#iframe1').contents().find('#viewerContainer').unbind("scroll");
					$('#iframe2').contents().find('#viewerContainer').unbind("scroll");
					$('#iframe1').contents().find('#viewerContainer').on("scroll", function(){
						srcollFlag = 1;
					});
					$('#iframe2').contents().find('#viewerContainer').on("scroll", function(){
						srcollFlag = 2;
					});
				}
			})
			$("#table").on("click","tr",function(){
				//$("#synchro").prop("checked",false)
				var page1 = $(this).children().eq(1).data("page");
				var text1 = $(this).children().eq(1).text();
				var page2 = $(this).children().eq(2).data("page");
				var text2 = $(this).children().eq(2).text();
				//$('#iframe1').contents().find('#viewerContainer').unbind("scroll");
				//$('#iframe2').contents().find('#viewerContainer').unbind("scroll");
				
				
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.page = page1;
				
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.findController.executeCommand('find', {
				    query: $(this).children().eq(1).text(),
				    phraseSearch: true,
				    caseSensitive: true,
				    highlightAll: true,
				    findPrevious: undefined
				});
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.page = page2;
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.findController.executeCommand('find', {
				    query: $(this).children().eq(2).text(),
				    phraseSearch: true,
				    caseSensitive: true,
				    highlightAll: true,
				    findPrevious: undefined
				});
//				$('#iframe1').contents().find('#viewerContainer').on("scroll", function(){
//					iframe1Scroll();
//				});
//				$('#iframe2').contents().find('#viewerContainer').on("scroll", function(){
//					iframe2Scroll();
//				});
			});
			var url = encodeURIComponent("/pdf.js/web/compressed.tracemonkey-pldi-09.pdf");
			var flag = 0;
			$("#iframe1").attr("src", "viewer.html?file=contract1.pdf");
			$("#iframe2").attr("src", "viewer.html?file=contract2.pdf");
			function search(v,type){
				if(type == undefined){
					type = "";
				}
				var data = {
					query: $("#search").val(),
				    phraseSearch: true,
				    caseSensitive: true,
				    highlightAll: true,
				    findPrevious: v,
				    type:type
				};
				pdfSearch(data);
			}
			function searchPrevious(){
				search(true,"again")
			}
			function searchNext(){
				search(false,"again")
			}
			function pdfSearch(evt){
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.findController.executeCommand('find' + evt.type, {
				    query: evt.query,
				    phraseSearch: evt.phraseSearch,
				    caseSensitive: evt.caseSensitive,
				    highlightAll: evt.highlightAll,
				    findPrevious: evt.findPrevious
				 });
			}
			var timer = null;
			var interval1 = setInterval('loadPdf1()', 100);
			function loadPdf1() {
				if(document.getElementById("iframe1").contentWindow.PDFViewerApplication.pdfDocument != null) {
					clearInterval(interval1);
					console.log('Load iframe1 Success...');
					localStorage.removeItem("pdfjs.history");
					flag++;
					$('#iframe1').contents().find('#viewerContainer').on("scroll",function(){
						iframe1Scroll();
					});
				}
			}
			var interval2 = setInterval('loadPdf2()', 100);
			function loadPdf2() {
				if(document.getElementById("iframe2").contentWindow.PDFViewerApplication.pdfDocument != null) {
					clearInterval(interval2);
					console.log('Load iframe2 Success...');
					localStorage.removeItem("pdfjs.history");
					flag++;
					$('#iframe2').contents().find('#viewerContainer').on("scroll", function(){
						iframe2Scroll();
					});
				}
			}
			function iframe1Scroll(){
				if(flag == 2){
			    	$('#iframe2').contents().find('#viewerContainer').unbind("scroll");
			    	var viewer2scrollTop = $('#iframe1').contents().find('#viewerContainer').scrollTop()/$('#iframe1').contents().find('#viewer').height()*$('#iframe2').contents().find('#viewer').height();
			    	$('#iframe2').contents().find('#viewerContainer').scrollTop(viewer2scrollTop);
			    	clearTimeout(timer);
			    	timer = setTimeout(function() {
			        	$('#iframe2').contents().find('#viewerContainer').on("scroll",function(){
			        		iframe2Scroll();
			        	});
			    	}, 300 );
			    }
			}
			function iframe2Scroll(){
				if(flag == 2){
					$('#iframe1').contents().find('#viewerContainer').unbind("scroll");
			    	var viewer1scrollTop = $('#iframe2').contents().find('#viewerContainer').scrollTop()/$('#iframe2').contents().find('#viewer').height()*$('#iframe1').contents().find('#viewer').height();
			    	$('#iframe1').contents().find('#viewerContainer').scrollTop(viewer1scrollTop);
			    	clearTimeout(timer);
			    	timer = setTimeout(function() {
			        	$('#iframe1').contents().find('#viewerContainer').on("scroll",function(){
			        		iframe1Scroll();
			        	});
			    	}, 300 );
			    }
			}
			function webViewerFirstPage(){
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.page = 1;
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.page = 1;
			}
			function webViewerLastPage(){
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.page = PDFViewerApplication.pagesCount;
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.page = PDFViewerApplication.pagesCount;
			}
			function webViewerPreviousPage(){
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.page--;
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.page--;
			}
			function webViewerNextPage(){
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.page++;
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.page++;
			}
			function webViewerZoomOut(){
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.zoomOut();
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.zoomOut();
			}
			function webViewerZoomIn(){
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.zoomIn();
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.zoomIn();
			}
			$("#scaleSelect").change(function(){
				if($(this).val() == "custom"){
					$("#customScale").removeClass("hidden");
				}else{
					$("#customScale").addClass("hidden");
					document.getElementById("iframe1").contentWindow.PDFViewerApplication.pdfViewer.currentScaleValue = $(this).val();
					document.getElementById("iframe2").contentWindow.PDFViewerApplication.pdfViewer.currentScaleValue = $(this).val();
				}
			})
			function customScale(){
				var value = $("#scalevalue").val();
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.pdfViewer.currentScaleValue = value;
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.pdfViewer.currentScaleValue = value;
			}
			function webViewerPrint(){
				document.getElementById("iframe1").contentWindow.window.print();
				document.getElementById("iframe2").contentWindow.window.print();
			}
			function webViewerDownload(){
				document.getElementById("iframe1").contentWindow.PDFViewerApplication.download();
				document.getElementById("iframe2").contentWindow.PDFViewerApplication.download();
			}
			
		</script>
	</body>

</html>