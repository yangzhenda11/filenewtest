!function(t){t.fn.treeTable=function(e){function r(r){var a=t(r.target);if(a.attr("controller")&&(a=a.parents("tr[haschild]").find("[arrow]")),a.attr("arrow")){var n=a.attr("class");if(n&&!n.indexOf(d.AN)){var s=e.theme.length+1;return n=n.split(" ")[1].substr(s),n=0===n.indexOf("hover_")?e.theme+"_"+n.substr(6):e.theme+"_hover_"+n,a.attr("class",d.AN+" "+n),!1}}return!1}function a(r,a){function n(t){if(0==o[t])return 1;var e=n(o[t]);return e+1}r.each(function(){var e=t(this).attr("pId")||0;l[e]||(l[e]=[]),l[e].push(this.id),o[this.id]=e,t(this).addClass(e)}).find("[controller]").css("cursor","pointer"),r.each(function(r){if(this.id){var s=t(this);l[this.id]&&s.attr("hasChild",!0);var h=l[o[this.id]];if(h[0]==this.id)s.attr("isFirstOne",!0);else{for(var f=0,r=0;r<h.length&&h[r]!=this.id;r++)f=h[r];s.attr("prevId",f)}h[h.length-1]==this.id&&s.attr("isLastOne",!0);var c=n(this.id);if(s.attr("depth",c),i(this),a&&(c>e.expandLevel&&s.hide(),s.attr("hasChild")&&s.attr("depth")<e.expandLevel)){var v=s.attr("isLastOne")?d.LO:d.O;s.find("."+d.AN).attr("class",d.AN+" "+v)}}})}function n(e){if(!l[e])return!1;for(var r=0;r<l[e].length;r++)n(l[e][r]);t("tr."+e,h).hide()}function s(e){if(t("tr."+e,h).show(),!l[e])return!1;for(var r=0;r<l[e].length;r++){var a=l[e][r];if(l[a]){var n=t("#"+a,h).find("."+d.AN).attr("class");(n==d.AN+" "+d.O||n==d.AN+" "+d.LO)&&s(a)}}}function i(r){var a=t(r),n=r.id;if(0==o[n])var s=t('<span class="prev_sp"></span>');else if(a.attr("isFirstOne")){var i=t("#"+o[n],h),s=i.children("td").eq(e.column).find(".prev_sp").clone();s.append(i.attr("isLastOne")?'<span class="'+d.N+" "+d.B+'"></span>':'<span class="'+d.N+" "+d.V+'"></span>')}else var s=t("#"+a.attr("prevId"),h).children("td").eq(e.column).find(".prev_sp").clone();if(a.attr("hasChild")){var l=a.attr("isLastOne")?d.LS:d.S;l=d.AN+" "+l}else var l=d.N+" "+(a.attr("isLastOne")?d.LL:d.L);var f=a.children("td").eq(e.column);f.prepend('<span arrow="true" class="'+l+'"></span>').prepend(s)}e=t.extend({path:"",theme:"default",expandLevel:1,column:0,onSelect:function(){},beforeExpand:function(){}},e);var h=this;h.addClass("tree_table");var d={N:e.theme+"_node",AN:e.theme+"_active_node",O:e.theme+"_open",LO:e.theme+"_last_open",S:e.theme+"_shut",LS:e.theme+"_last_shut",HO:e.theme+"_hover_open",HS:e.theme+"_hover_shut",HLO:e.theme+"_hover_last_open",HLS:e.theme+"_hover_last_shut",L:e.theme+"_leaf",LL:e.theme+"_last_leaf",B:e.theme+"_blank",V:e.theme+"_vertline"},l={},o={},f=h.find("tr");return a(f,!0),h.unbind(),h.bind("click",function(r){var a=t(r.target);if(a.attr("controller")){if(a=a.parents("tr[haschild]").find("[arrow]"),-1==a.attr("class").indexOf(d.AN)&&-1==a.attr("class").indexOf(d.N))return;var i=a.parents("tr[haschild]")[0].id;if(e.onSelect&&e.onSelect(h,i)===!1)return}if(a.attr("arrow")){var l=a.attr("class");if(l==d.AN+" "+d.HLO||l==d.AN+" "+d.HO){var i=a.parents("tr[haschild]")[0].id;return a.attr("class",d.AN+" "+(-1!=l.indexOf(d.HO)?d.HS:d.HLS)),void n(i)}if(l==d.AN+" "+d.HLS||l==d.AN+" "+d.HS){var i=a.parents("tr")[0].id;return a.attr("class",d.AN+" "+(-1!=l.indexOf(d.HS)?d.HO:d.HLO)),e.beforeExpand(h,i),void s(i)}}}),h.mouseover(r).mouseout(r),h.addChilds=function(e){var r=t(e);if(!r.length)return!1;var n=t(r[0]).attr("pId");if(!n)return!1;var s=l[n]&&l[n][l[n].length-1]||n;t("#"+s,h).after(r),a(r)},h}}(jQuery);