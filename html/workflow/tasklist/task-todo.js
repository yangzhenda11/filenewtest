function initFrame(){$("#searchContent").show()}function serarchForToDo(e){var t=$("#searchTableTodo").DataTable();e?t.ajax.reload(null,!1):t.ajax.reload()}function resetConditionForToDo(){$("#processTitle").val(""),$("#linkName").val(""),$("input[name='startDate']").val(""),$("input[name='endDate']").val("")}function handleTaskToDo(e,t,a,n,o,r,i,s,l){$("#taskId").val(e),$("#taskDefinitionKey").val(t),$("#name").val(a),$("#processInstanceId").val(n),$("#title").val(o),$("#processDefinitionId").val(r),$("#processDefinitionKey").val(i),$("#executionId").val(s),$("#assigneeId").val(l),$("#goTaskToDoDetailForToDo").load("/html/workflow/taskdetail/task-todo.html"),$("#goTaskToDoDetailForToDo").show(),$("#searchContentForToDo").hide()}function applyTaskToDo(e,t,a,n,o,r,i,s,l){var c={taskDefinitionKey:t,assignee:l,processInstanceId:n,taskId:e};$.post(serverPath+"workflowrest/applyCandidateTask",c,function(e){1==result.success?(layer.msg(e.sign),serarchForToDo()):layer.msg(e.sign)})}function checkifdone(e){var t=!1;return $.ajax({cache:!0,type:"POST",url:serverPath+"workflowrest/checktask?taskId="+e,async:!1,error:function(){layer.msg("校验待办异常，请联系管理员!",{time:1e3})},success:function(e){var a=e.success;"1"==a?t=!1:(t=!0,layer.msg(e.info))},error:function(e){App.ajaxErrorCallback(e)}}),t}function getFlowKyeList(){$.ajax({cache:!0,type:"POST",url:serverPath+"workflowrest/getFlowKeyList",async:!1,error:function(){layer.msg("获取流程类型异常，请联系管理员!",{time:1e3})},success:function(e){var t=e.dataArray;console.log(e),$("#flowType").append("<option value=''>请选择流程类型</option>"),$.each(t,function(e,t){$("#flowType").append("<option value='"+t.value+"'>"+t.label+"</option>")})},error:function(e){App.ajaxErrorCallback(e)}})}var config=parent.globalConfig,serverPath=config.serverPath,curStaffOrgId=config.curStaffOrgId,curStaffId=config.curStaffId;$(function(){getFlowKyeList(),$("#currentId").val(curStaffOrgId)});var btnModel='    	{{#each func}}    <button type="button" class="btn primary btn-outline btn-xs {{this.type}}" {{this.title}} {{this.fn}}>{{this.name}}</button>    {{/each}}',template=Handlebars.compile(btnModel);App.initDataTables("#searchTableTodo","#submitBtn",{ajax:{type:"GET",url:serverPath+"workflowrest/taskToDo",data:function(e){return e.title=$("#processTitle").val(),e.createTimeStart=$("#startDate").val(),e.createTimeEnd=$("#endDate").val(),e.staffId=curStaffId,e.flowType=$("#flowType").val(),e.contractCode=$("#contractCode").val(),e}},columns:[{data:null,title:"序号",className:"text-center",render:function(e,t,a,n){var o=App.getDatatablePaging("#searchTableTodo").pageStart;return o+n.row+1}},{data:"title",title:"主题",className:"whiteSpaceNormal text-center",width:"35%"},{data:"processDefinitionName",title:"流程类型",className:"whiteSpaceNormal text-center",width:"23%"},{data:"createTime",title:"接收日期",className:"whiteSpaceNormal text-center",width:"15%",render:function(e){return getSmpFormatDateByLong(e,!0)}},{data:"beUserName",title:"发送人",className:"text-center",width:"10%"},{data:null,title:"操作",className:"text-center",width:"10%"}],columnDefs:[{targets:"_all",defaultContent:""},{targets:-1,render:function(e,t,a){var n=$("#currentId").val(),o=a.assignee,r="",i="disabled",s="title=当前任务属于【"+a.staffOrgName+"】，请切换岗位后处理",l="";n==o&&(i="",s="",l="onclick=handleTaskToDo('"+a.id+"','"+a.taskDefinitionKey+"','"+a.name+"','"+a.processInstanceId+"','"+a.title+"','"+a.processDefinitionId+"','"+a.processDefinitionKey+"','"+a.executionId+"','"+a.assignee+"')",r={func:[{name:"处理",title:s,fn:l,type:i}]}),-1!=o.indexOf("candidate-")&&(i="",s="title=该任务为抢单任务，如需处理请先点【申领】按钮领取任务！",l="onclick=applyTaskToDo('"+a.id+"','"+a.taskDefinitionKey+"','"+a.name+"','"+a.processInstanceId+"','"+a.title+"','"+a.processDefinitionId+"','"+a.processDefinitionKey+"','"+a.executionId+"','"+a.assignee+"')",r={func:[{name:"申领",title:s,fn:l,type:i}]});var c=template(r);return c}}]});