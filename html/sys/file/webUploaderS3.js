function downloadUrl(a){var e=serverPath+"fileload/downloadS3Url",l=a.substr(0,a.lastIndexOf("."));$.ajax({url:e,type:"post",data:{key:l},success:function(a){""!=a&&(console.log(a.data),$("#imgFile").show(),$("#imgFile").attr("src",a.data),$("#imgFile").attr("width","256px"),$("#imgFile").attr("height","256px"));var e=$("#uploadTable").DataTable();e.ajax.reload()},error:function(a){App.ajaxErrorCallback(a)}})}function disImg(){$("#imgFile").hide();var a=$("#uploadTable").DataTable();a.ajax.reload()}function deleteFile(a){var e=serverPath+"fileload/delete",l=a.substr(0,a.lastIndexOf("."));$.ajax({url:e,type:"post",data:{key:l},success:function(a){alert(a.message);var e=$("#uploadTable").DataTable();e.ajax.reload()},error:function(a){App.ajaxErrorCallback(a)}})}var config=parent.globalConfig,serverPath=config.serverPath,uploadTable=App.initDataTables("#uploadTable",{ajax:{type:"GET",url:serverPath+"fileload/getAllBucketObject",data:function(a){return a.bucketName="my-new-bucket",a}},columns:[{data:"key",className:"text-center",title:"操作",render:function(a){var e='<a href="/fileload/downloadS3?key='+a.substr(0,a.lastIndexOf("."))+'">下载</a>';if(e=e+'<a style="margin-left:15px" href="#" onclick="deleteFile(\''+a+"')\">删除</a>",/\.(gif|jpg|jpeg|png|bmp|GIF|JPG|PNG)$/.test(a))if("none"==$("#imgFile").css("display"))e=e+'<a class="btn primary btn-outline btn-xs" style="margin-left:15px" onclick = "downloadUrl(\''+a+"')\">显示图片</a>";else{var l=$("#imgFile")[0].src;-1!=decodeURI(l).indexOf(a)?e+='<a class="btn primary btn-outline btn-xs" style="margin-left:15px" onclick = "disImg()">隐藏图片</a>':e=e+'<a class="btn primary btn-outline btn-xs" style="margin-left:15px" onclick = "downloadUrl(\''+a+"')\">显示图片</a>"}return e}},{data:"key",title:"key",className:"text-center"},{data:"size",className:"text-center",title:"size"}]});!function(a,e){e("#fileName").fileinput({language:"zh",uploadUrl:serverPath+"fileload/uploadFileS3",uploadAsync:!1,maxFileSize:51200,maxFileCount:10,dropZoneEnabled:!1,slugCallback:function(a){return a},uploadExtraData:function(){var a={displayName:""};return a}}),e("#fileName").on("fileuploaded",function(a,l){alert(l.response.message);var t=e("#uploadTable").DataTable();t.ajax.reload()}),e("#fileName").on("filebatchuploadsuccess",function(a,l){alert(l.response.message),e("#fileName").fileinput("reset");var t=e("#uploadTable").DataTable();t.ajax.reload()})}(window,jQuery);