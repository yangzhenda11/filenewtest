<div class="form-fieldset">
	<div class="form-fieldset-title">
		<span><i class="iconfont icon-layers"></i> 账号信息</span>
		<div class="form-fieldset-tools">
			<a href="#" class="form-collapse"><i class="fa fa-angle-up"></i></a>
		</div>
	</div>
	<div class="form-fieldset-body" id="accountListContent">
		<div class="row">
			<div class="portlet" id="payeeAccountInfo">
                <div class="portlet-title ">
                    <div class="caption font-dark contract">
                        <span class="caption-subject bold uppercase">收款方账号信息</span>
                    </div>
                </div>
                <div class="portlet-body">
                	<div class="tableToobarContent hidden" id="payeeInforToolbar">
                		<button class="btn red" type="button" onclick="addAccountTableTr(1)"><i class="iconfont icon-add"></i>新增</button>
                		<button class="btn red" type="button" onclick="delectsPayeeTr()"><i class="iconfont icon-shanchu"></i>删除</button>
                	</div>    	
                    <table class="table table-hover table-bordered table-striped table-align">
                    	<thead>
							<tr>
								<th class="accountEdit"><label class='ui-checkbox'><input type='checkbox' name='payeeCheckAll' id="payeeCheckAll"><span></span></label></th>
								<th class="isRequiredIcon">收款方账户名称</th>
								<th class="isRequiredIcon">收款方银行账号</th>
								<th class="isRequiredIcon">收款方开户银行</th>
								<th class="accountEdit">操作</th>
							</tr>
						</thead>
						<tbody id="payeeInfoTbody">
							<tr class="emptyTr">
								<td colspan="5">暂无收款方账号信息</td>
							</tr>
						</tbody>
					</table>
            	</div>
       	   </div>
       	   <div class="portlet" id="payerAccountInfo">
                <div class="portlet-title ">
                    <div class="caption font-dark contract">
                        <span class="caption-subject bold uppercase">付款方账号信息</span>
                    </div>
                </div>
                <div class="portlet-body">
                	<div class="tableToobarContent hidden" id="payerInforToolbar">
                		<button class="btn red" type="button" onclick="addAccountTableTr(2)"><i class="iconfont icon-add"></i>新增</button>
                		<button class="btn red" type="button" onclick="delectsPayerTr()"><i class="iconfont icon-shanchu"></i>删除</button>
                	</div>    	
                    <table class="table table-hover table-bordered table-striped table-align">
                    	<thead>
							<tr>
								<th class="accountEdit"><label class='ui-checkbox'><input type='checkbox' name='payerCheckAll' id="payerCheckAll"><span></span></label></th>
								<th>付款方账户名称</th>
								<th>付款方银行账号</th>
								<th>付款方开户银行</th>
								<th class="accountEdit">操作</th>
							</tr>
						</thead>
						<tbody id="payerInfoTbody">
							<tr class="emptyTr">
								<td colspan="5">暂无付款方账号信息</td>
							</tr>
						</tbody>
					</table>
            	</div>
       	   </div>
		</div>
	</div>
</div>
<script type="text/javascript">
	/*
	 * 设置页面的id值，由保存和提交后回调
	 */
	function setPageId_accountListId(value){
		var valueKey = 0;
		$.each($("#accountListContent tr"), function(k,v) {
			if(!$(v).hasClass("emptyTr")){
				if($(v).data("id") != undefined){
					$(v).data("id",value[valueKey]);
					valueKey++;
				}
			}
		});
	}
	/*
	 * 返回本页面数据，若无返回{}，若不提交本页面的值可删除此方法
	 * isSubmit 提交时为true,判断页面是否要加逻辑上的验证(bootstrap-validator验证除外)
	 */
	function getValue_accountList(isSubmit){
		var accountDataList = [];
		accountDataList = returnAccoutTableInfor("payeeInfoTbody",accountDataList);
		accountDataList = returnAccoutTableInfor("payerInfoTbody",accountDataList);
		//当合同总览中"固定金额"为"是"时，加校验"至少有一条收款方信息";
		var isFixedValue = $("input[name='isFixed']:checked").val();
		if(isSubmit && isFixedValue == 1){
			var havePayeeInfo = false;
			$.each(accountDataList, function(k,v) {
				if(v.accountType == 1){
					havePayeeInfo = true;
					return;
				}
			});
			if(havePayeeInfo){
				return accountDataList;
			}else{
				layer.msg("请至少填写一项收款方信息");
				srolloOffect("#payeeAccountInfo");
				return false;
			}
		}else{
			return accountDataList;
		}
	}
	/*
	 * 返回table的信息
	 */
	function returnAccoutTableInfor(dom,accountDataList){
		$.each($("#"+ dom +" tr"),function(k,v){
			if(!$(v).hasClass("emptyTr")){
				var accountDataItem = {};
				if(dom == "payerInfoTbody"){
					accountDataItem.accountType = 2;
				}else if(dom == "payeeInfoTbody"){
					accountDataItem.accountType = 1;
				};
				accountDataItem.wcardId = wcardId;
				accountDataItem.contractNumber = contractNumber;
				accountDataItem.accountId = $(v).data("id");
				accountDataItem.accountName = $(v).find(".accountName").val();
				accountDataItem.accountNumber = $(v).find(".accountNumber").val();
				accountDataItem.openBank = $(v).find(".openBank").val();
				accountDataList.push(accountDataItem);
			}
		});
		return accountDataList;
	}
	/*
	 * 去除多于的行
	 */
	function removeMorethan_accountList(){
		var payerTableValue = [];
		var payeeTableValue = [];
		payerTableValue = returnAccoutTableInfor("payerInfoTbody",payerTableValue);
		payeeTableValue = returnAccoutTableInfor("payeeInfoTbody",payeeTableValue);
		var payerEmptyList = getAccountEmptyValueList(payerTableValue);
		var payeeEmptyList = getAccountEmptyValueList(payeeTableValue);
		$.each(payerEmptyList, function(m,n) {
			var index = n - m;
			$("#payerInfoTbody tr").eq(index).remove();
		});
		addPayerInfoTbodyEmptyTr();
		$.each(payeeEmptyList, function(m,n) {
			var index = n - m;
			$("#payeeInfoTbody tr").eq(index).remove();
		});
		addPayeeInfoTbodyEmptyTr();
	};
	function getAccountEmptyValueList(tableValue){
		var emptyList = [];
		for(var i = 0; i < tableValue.length; i++){
			var tableItem = tableValue[i];
			var isEmpty = true;
			delete tableItem.accountType;
			delete tableItem.contractNumber;
			delete tableItem.wcardId;
			delete tableItem.accountId;
			$.each(tableItem, function(k,v) {
				if(v){
					isEmpty = false;
					return false;
				}
			});
			if(isEmpty){
				emptyList.push(i);
			}
		};
		return emptyList;
	}
	//name自增基础值
	var isCreateAccountTrLength = 0;
	//获取账户信息
	getAccountInfo();
	
	/*
	 * 获取账户信息
	 */
	function getAccountInfo() {
		var url = serverPath + "contractOrderEditorController/getAccountId";
		var postData = JSON.stringify({wcardId:wcardId});
		App.formAjaxJson(url, "post", postData, successCallback);

		function successCallback(result) {
			setRequiredIcon();
			var data = result.data;
			if(data.length > 0){
				for(var i = 0; i < data.length; i++){
					addAccountTableTr(data[i].accountType,data[i]);
				};
			};
			/*
			 * isEdit 判断页面是否只能查看
			 */
			if(!isEdit){
				$("#accountListContent").find("input").attr("disabled","disabled");
				$("#payeeInforToolbar,#payerInforToolbar,.accountEdit").remove();
			}else{
				$("#payeeInforToolbar,#payerInforToolbar").removeClass("hidden");
			}
		}
	}
	/*
	 * 增加处理
	 * accountType ： 1 收款方  2 付款方
	 * 
	 */
	function addAccountTableTr(accountType,data){
		isCreateAccountTrLength++;
		var accountId = "100000";
		var accountNameVal = '';
		var accountNumberVal = '';
		var openBankVal = '';
		var accountName = "accountName" + isCreateAccountTrLength;
		var accountNumber = "accountNumber" + isCreateAccountTrLength;
		var openBank = "openBank" + isCreateAccountTrLength;
		if(data){
			accountId = data.accountId ? data.accountId : "100000";
			accountNameVal = data.accountName;
			accountNumberVal = data.accountNumber;
			openBankVal = data.openBank;
		};
		if(accountType == 1){
			if($("#payeeInfoTbody .emptyTr")[0] != undefined){
				$("#payeeInfoTbody .emptyTr").remove();
			};
			var appendHtml = "<tr data-id='"+ accountId +"'>"+
								"<td class='accountEdit'><label class='ui-checkbox'><input type='checkbox' name='payeeCheck'><span></span></label></td>"+
								"<td><div class='form-group'><input type='text' class='form-control accountName' name='"+ accountName +"' placeholder='"+setPTip('请输入收款方账户名称')+"' value='"+ accountNameVal +"' maxlength='240' /></div></td>"+
								"<td><div class='form-group'><input type='text' class='form-control accountNumber' name='"+ accountNumber +"' placeholder='"+setPTip('请输入收款方银行账号')+"' value='"+ accountNumberVal +"' maxlength='40' /></div></td>"+
								"<td><div class='form-group'><input type='text' class='form-control openBank' name='"+ openBank +"' placeholder='"+setPTip('请输入收款方开户银行')+"' value='"+ openBankVal +"' maxlength='240' /></div></td>"+
								"<td class='accountEdit'><button type='button' class='btn primary btn-outline btn-xs' onclick='delectPayeeTr(this)'>删除</button></td>"+
							"</tr>";
			$("#payeeInfoTbody").append(appendHtml);
			addNotEmptyValidatorField(accountName,"请输入不超过240个字符的收款方账户名称");
			addNotEmptyValidatorField(accountNumber,"请输入不超过40个字符的收款方银行账号");
			addNotEmptyValidatorField(openBank,"请输入不超过240个字符的收款方开户银行");
			App.checkAllFn("#payeeCheckAll","payeeCheck");
		}else if(accountType == 2){
			if($("#payerInfoTbody .emptyTr")[0] != undefined){
				$("#payerInfoTbody .emptyTr").remove();
			};
			var appendHtml = "<tr data-id='"+accountId +"'>"+
								"<td class='accountEdit'><label class='ui-checkbox'><input type='checkbox' name='payerCheck'><span></span></label></td>"+
								"<td><div class='form-group'><input type='text' class='form-control accountName' name='"+ accountName +"' placeholder='"+setPTip('请输入付款方账户名称')+"' value='"+ accountNameVal +"' maxlength='240' /></div></td>"+
								"<td><div class='form-group'><input type='text' class='form-control accountNumber' name='"+ accountNumber +"' placeholder='"+setPTip('请输入付款方银行账号')+"' value='"+ accountNumberVal +"' maxlength='40' /></div></td>"+
								"<td><div class='form-group'><input type='text' class='form-control openBank' name='"+ openBank +"' placeholder='"+setPTip('请输入付款方开户银行')+"' value='"+ openBankVal +"' maxlength='240' /></div></td>"+
								"<td class='accountEdit'><button type='button' class='btn primary btn-outline btn-xs' onclick='delectPayerTr(this)'>删除</button></td>"+
							"</tr>";
			$("#payerInfoTbody").append(appendHtml);
			addNotEmptyValidatorField(accountName,"请输入不超过240个字符的付款方账户名称");
			addNotEmptyValidatorField(accountNumber,"请输入不超过40个字符的付款方银行账号");
			addNotEmptyValidatorField(openBank,"请输入不超过240个字符的付款方开户银行");
			App.checkAllFn("#payerCheckAll","payerCheck");
		}
	}
	
	
	/*
	 * 批量删除收款方表格数据
	 */
	function delectsPayeeTr(){
		var checkInvoiceLength = $("#payeeInfoTbody input[name='payeeCheck']:checked").length;
		if(checkInvoiceLength == 0){
			layer.msg("请勾选要删除的收款方账户信息");
		}else{
			layer.confirm("是否要删除这"+checkInvoiceLength+"条数据？",{icon:7,title:"提示"},function(index){
				layer.close(index);
				$.each($("#payeeInfoTbody input[name='payeeCheck']:checked"), function(k,v) {
					$(v).parents("tr").remove();
				});
				App.checkAllFn("#payeeCheckAll","payeeCheck");
				addPayeeInfoTbodyEmptyTr();
			})
		}
	}
	/*
	 * 删除收款方表格数据
	 */
	function delectPayeeTr(dom){
		layer.confirm("是否要删除此条数据？",{icon:7,title:"提示"},function(index){
			layer.close(index);
			$(dom).parents("tr").remove();
			App.checkAllFn("#payeeCheckAll","payeeCheck");
			addPayeeInfoTbodyEmptyTr();
		})
	}
	/*
	 * 若为空增加empty值
	 */
	function addPayeeInfoTbodyEmptyTr(){
		if($("#payeeInfoTbody tr").length == 0){
			var html = '<tr class="emptyTr"><td colspan="5">暂无收款方账号信息</td></tr>';
			$("#payeeInfoTbody").html(html);
		}
	}
	
	/*
	 * 批量删除付款方表格数据
	 */
	function delectsPayerTr(){
		var checkInvoiceLength = $("#payerInfoTbody input[name='payerCheck']:checked").length;
		if(checkInvoiceLength == 0){
			layer.msg("请勾选要删除的付款方账户信息");
		}else{
			layer.confirm("是否要删除这"+checkInvoiceLength+"条数据？",{icon:7,title:"提示"},function(index){
				layer.close(index);
				$.each($("#payerInfoTbody input[name='payerCheck']:checked"), function(k,v) {
					$(v).parents("tr").remove();
				});
				App.checkAllFn("#payerCheckAll","payerCheck");
				addPayerInfoTbodyEmptyTr();
			})
		}
	}
	/*
	 * 删除付款方表格数据
	 */
	function delectPayerTr(dom){
		layer.confirm("是否要删除此条数据？",{icon:7,title:"提示"},function(index){
			layer.close(index);
			$(dom).parents("tr").remove();
			App.checkAllFn("#payerCheckAll","payerCheck");
			addPayerInfoTbodyEmptyTr();
		})
	}
	/*
	 * 若为空增加empty值
	 */
	function addPayerInfoTbodyEmptyTr(){
		if($("#payerInfoTbody tr").length == 0){
			var html = '<tr class="emptyTr"><td colspan="5">暂无付款方账号信息</td></tr>';
			$("#payerInfoTbody").html(html);
		}
	}
</script>