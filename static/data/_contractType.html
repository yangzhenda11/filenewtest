<link rel="stylesheet" type="text/css" href="/static/plugins/zTree/css/zTreeStyle/zTreeStyle.css" />
<link rel="stylesheet" type="text/css" href="/static/plugins/zTree/css/metroStyle/metroStyle.css">
<style type="text/css">
	.contractTypeTree{
		overflow: auto;
	}
	.actionTools{
		margin-bottom: 8px;
	}
	.actionTools button{
		margin-right: 12px;
	}
</style>
<div class="modal-dialog" role="document">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="myModalLabel">合同类型选择</h4>
		</div>
		<div class="modal-body" style="padding-left: 10%;padding-top: 10px;">
			<div class="actionTools">
				<button class="btn red" onclick="expandAll()">全部展开</button>
				<button class="btn red" onclick="collapseAll()">全部收起</button>
			</div>
			<ul id="contractTypeTree" class="ztree contractTypeTree"></ul>
		</div>
	</div>
</div>
<script src="/static/plugins/zTree/js/jquery.ztree.all.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	//系统全局变量获取
	var config = top.globalConfig;
	var serverPath = config.serverPath;
	//树的全局变量
	var contractTypeTree = null;
	//设置树的高度
	var documentHeight = $(".page-content").height() - 165;
	$("#contractTypeTree").css("max-height",documentHeight);	
	//生成树
	function initContractTree(dom,textValue,setKey,ajaxData) {
		$("#commomModal").modal("show");
		//配置
		var treeSetting = {
			view: {
				selectedMulti: false
			},
			data: {
				simpleData: {
					enable: true,
					idKey: "typeCode",
					pIdKey: "parentCode",
					rootPId: 0
				},
				key: {
					name: "typeName"
				}
			},
			callback: {
				onClick: setInputInfo
			}
		};
		//获取数据
		App.formAjaxJson(serverPath + "contractType/list", "post", JSON.stringify(ajaxData), successCallback);

		function successCallback(result) {
			var data = result.data;
			if(data != "") {
				if(contractTypeTree){
					contractTypeTree.destroy();
				}
				contractTypeTree = $.fn.zTree.init($("#contractTypeTree"), treeSetting, data);
			}else{
				layer.msg("暂无数据，请稍后重试");
			}
		}
		//点击设置input框的值setKey >> data-key 
		function setInputInfo(event, treeId, treeNode) {
			if(setKey != undefined){
				if($.isArray(setKey)){
					$.each(setKey, function(k,v) {
						$(dom).data(v,treeNode[v]);
					});
				}else{
					$(dom).data(setKey,treeNode[setKey]);
				}
			};
			$(dom).data("exactSearch",true);
			$(dom).val(treeNode[textValue]);
			$(dom).attr("title",treeNode[textValue]);
			$("#commomModal").modal("hide");
		}
	}
	// 展开所有
	function expandAll() {
	    var nodes = contractTypeTree.getNodes();
	    expandNodes(nodes);
	}
	// 展开所有节点及其子节点
	function expandNodes(nodes) {
	    if (!nodes)
	        return;
	    for (var i = 0, l = nodes.length; i < l; i++) {
	        contractTypeTree.expandNode(nodes[i], true, false, false);
	        if (nodes[i].isParent) {
	            expandNodes(nodes[i].children);
	        }
	    }
	}
	// 关闭所有
	function collapseAll() {
	    contractTypeTree.expandAll(false);
	}
</script>