<div class="form-fieldset">
	<div class="form-fieldset-title">
		<div class="fieldset-title">
			<p>合同总览</p><span></span>
		</div>
		<div class="form-fieldset-tools">
			<a class="form-collapse"><i class="fa fa-angle-up"></i></a>
		</div>
	</div>
	<div class="form-fieldset-body">
		<div class="row defaultFieldsetForm" id="contractOverviewForm">
			<div class="col-sm-6 form-group">
				<label for="contractNumber" class="control-label">合同编号：</label>
				<div class="valiParent">
					<input type="text" class="form-control" id="contractNumber" name="contractNumber" disabled="disabled" />
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="typeFullname" class="control-label">合同类型：</label>
				<div class="valiParent">
					<input type="text" class="form-control" id="typeFullname" name="typeFullname" disabled="disabled" />
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="contractName" class="control-label">合同名称：</label>
				<div class="valiParent">
					<input type="text" class="form-control" id="contractName" name="contractName" disabled="disabled" />
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="executeStatus" class="control-label">合同履行现状：</label>
				<div class="valiParent">
					<input type="text" class="form-control" id="executeStatus" name="executeStatus" disabled="disabled" />
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="ourPartyName" class="control-label">我方主体：</label>
				<div class="valiParent">
					<div id="ourPartyName" class="divInput"></div>
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="otherPartyName" class="control-label">对方主体：</label>
				<div class="valiParent otherPartyParent">
					<div id="otherPartyName" class="divInput"></div>
				</div>
				<button type="button" class="btn blue" id="partyMore">更多</button>
			</div>
			<div id="partyContent" class="hidden">
				<div class="col-sm-6 form-group">
					<label for="partyALegalperson" class="control-label">我方法定代表人：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="partyALegalperson" name="partyALegalperson" maxlength="100" />
					</div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="partyZLegalperson" class="control-label">对方法定代表人：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="partyZLegalperson" name="partyZLegalperson" maxlength="100" />
					</div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="partyAContact" class="control-label">我方联系人：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="partyAContact" name="partyAContact" maxlength="100" />
					</div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="partyZContact" class="control-label">对方联系人：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="partyZContact" name="partyZContact" maxlength="100" />
					</div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="partyARegaddr" class="control-label">我方注册地址：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="partyARegaddr" name="partyARegaddr" maxlength="100" />
					</div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="partyZRegaddr" class="control-label">对方注册地址：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="partyZRegaddr" name="partyZRegaddr" maxlength="100" />
					</div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="partyATelephone" class="control-label">我方联系电话：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="partyATelephone" name="partyATelephone" maxlength="100" />
					</div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="partyZTelephone" class="control-label">对方联系电话：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="partyZTelephone" name="partyZTelephone" maxlength="100" />
					</div>
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="executeDeptName" class="control-label">承办部门：</label>
				<div class="valiParent">
					<input type="text" class="form-control" id="executeDeptName" name="executeDeptName" disabled="disabled" />
				</div>
			</div>
			<div class="col-sm-6 form-group">
				<label for="undertakeName" class="control-label">承办人联系方式：</label>
				<div class="valiParent">
					<div class="col-sm-3 paddingL0">
						<input type="text" class="form-control" id="undertakeName" name="undertakeName" disabled="disabled" />
					</div>
					<div class="col-sm-4">
						<input type="text" class="form-control" id="mobilPhone" name="mobilPhone" disabled="disabled" />
					</div>
					<div class="col-sm-5 paddingR0">
						<input type="text" class="form-control" id="phone" name="phone" disabled="disabled" />
					</div>
				</div>
			</div>
			<span id="relatedDom0" class="hidden">
				<div class="col-sm-6 form-group">
					<label for="relatedWcardNumber" class="control-label">关联工单编号：</label>
					<div class="valiParent relatedWcardNumber" id="relatedWcardNumber"></div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="contractNature" class="control-label">合同性质：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="contractNature" name="contractNature" disabled="disabled" />
					</div>
				</div>
				<div class="col-sm-6 form-group">
					<label for="relatedContractNumber" class="control-label">关联合同编号：</label>
					<div class="valiParent">
						<input type="text" class="form-control" id="relatedContractNumber" name="relatedContractNumber" disabled="disabled" />
					</div>
				</div>
			</span>
			<div id="isOtherTypeOverview" class="hidden">
				<div class="col-sm-6 form-group">
					<label for="isFixed" class="control-label">是否固定金额：</label>

					<div class="valiParent">
						<div class="ui-radio-list ui-radio-inline">
							<label class="ui-radio">
								是
								<input type="radio" value="1" disabled="disabled" name="isFixed">
								<span></span>
							</label>
							<label class="ui-radio">
								否
								<input type="radio" value="2" disabled="disabled" name="isFixed">
								<span></span>
							</label>
						</div>
					</div>
				</div>
				<div id="defalutContract" class="hidden">
					<div class="col-sm-6 form-group">
						<label for="vatRate" class="control-label">增值税税率：</label>
						<div class="valiParent">
							<input type="text" class="form-control" id="vatRate" name="vatRate" disabled="disabled" />
						</div>
					</div>
					<div class="col-sm-6 form-group">
						<label for="contractValue" class="control-label">含增值税合同金额：</label>
						<div class="valiParent">
							<input type="text" class="form-control" id="contractValue" name="contractValue" disabled="disabled" />
						</div>
					</div>
					<div class="col-sm-6 form-group">
						<label for="contractValueNovat" class="control-label">不含增值税合同金额：</label>
						<div class="valiParent">
							<input type="text" class="form-control" id="contractValueNovat" name="contractValueNovat" disabled="disabled" />
						</div>
					</div>
				</div>
				<div id="relationshipContract" class="hidden">
					<span id="relatedDom1" class="hidden">
					<div class="col-sm-6 form-group">
						<label for="relatedWcardNumber" class="control-label">关联工单编号：</label>
						<div class="valiParent relatedWcardNumber" id="relatedWcardNumber"></div>
					</div>
					<div class="col-sm-6 form-group">
						<label for="contractNature" class="control-label">合同性质：</label>
						<div class="valiParent">
							<input type="text" class="form-control" id="contractNature" name="contractNature" disabled="disabled" />
						</div>
					</div>
					<div class="col-sm-6 form-group">
						<label for="relatedContractNumber" class="control-label">关联合同编号：</label>
						<div class="valiParent">
							<input type="text" class="form-control" id="relatedContractNumber" name="relatedContractNumber" disabled="disabled" />
						</div>
					</div>
					</span>
					<div id="relationshipIsFixed" class="hidden">
						<div class="col-sm-6 form-group" id="originalContractValueContent">
							<label for="originalContractValue" class="control-label">原含增值税合同金额：</label>
							<div class="valiParent">
								<input type="text" class="form-control" id="originalContractValue" name="originalContractValue" disabled="disabled" />
							</div>
						</div>
						<div class="col-sm-6 form-group">
							<label for="contractValue" class="control-label" id="contractValueLable"></label>
							<div class="valiParent">
								<input type="text" class="form-control" id="contractValue" name="contractValue" disabled="disabled" />
							</div>
						</div>
						<div class="col-sm-6 form-group" id="originalContractValueNovatContent">
							<label for="originalContractValueNovat" class="control-label">原不含增值税合同金额：</label>
							<div class="valiParent">
								<input type="text" class="form-control" id="originalContractValueNovat" name="originalContractValueNovat" disabled="disabled" />
							</div>
						</div>
						<div class="col-sm-6 form-group">
							<label for="contractValueNovat" class="control-label" id="contractValueNovatLable"></label>
							<div class="valiParent">
								<input type="text" class="form-control" id="contractValueNovat" name="contractValueNovat" disabled="disabled" />
							</div>
						</div>
						<div class="col-sm-6 form-group" id="originalVatRateContent">
							<label for="originalVatRate" class="control-label">原增值税税率：</label>
							<div class="valiParent">
								<input type="text" class="form-control" id="originalVatRate" name="originalVatRate" disabled="disabled" />
							</div>
						</div>
						<div class="col-sm-6 form-group">
							<label for="vatRate" class="control-label" id="vatRateLable"></label>
							<div class="valiParent">
								<input type="text" class="form-control" id="vatRate" name="vatRate" disabled="disabled" />
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	/*
	 * 返回本页面数据，若无返回{}，若不提交本页面的值可删除此方法
	 * isSubmit 提交时为true,判断页面是否要加逻辑上的验证(bootstrap-validator验证除外)
	 */
	function getValue_contractOverv(isSubmit){
		var contractOverData = App.getFormValues($("#contractOverviewForm"));
		var performerOrgType = $("#contractFeasorContent input[name='performerType']:checked").val();
		contractOverData.performerOrgType = performerOrgType;
		contractOverData.wcardId = wcardId;
		contractOverData.contractId = contractId;
		contractOverData.isFixed = $("#isOtherTypeOverview input[name='isFixed']:checked").val();
		return contractOverData;
	}
	/*
	 * isEdit 判断页面是否只能查看
	 */
	if(!isEdit){
		$("#contractOverviewForm").find("input,select").attr("disabled","disabled");
	};
	//获取字典值
	getContractOverviewDict();
	//wcardTypeCode为0时其余合同，隐藏
	if(wcardTypeCode != 0){
		$("#isOtherTypeOverview,#relatedDom1").removeClass("hidden");
		$("#relatedDom0").remove();
	}else{
		$("#relatedDom1").remove();
	}
	//获取合同基本信息
	getContractOverInfo();
	
	var ticketStateType = new Object();
	var performanceState = new Object();
	/*
	 * 获取字典值
	 * 合同工单状态   ticketStateType
	 * 合同履行现状	performanceState
	 */
	function getContractOverviewDict() {
		ticketStateType = App.getDictInfo(9040);
		performanceState = App.getDictInfo(9010);
	}
	/*
	 * 合同基本信息填充
	 */
	function getContractOverInfo() {
		var data = getContractOrderBaseInfoData;
		var isFixed = data.isFixed;
		var contractNature = data.contractNature;
		var ourPartyName = data.ourPartyName == null ? "" : data.ourPartyName;
		var otherPartyName = data.otherPartyName == null ? "" : data.otherPartyName;
		$("#ourPartyName").text(ourPartyName);
		$("#otherPartyName").text(otherPartyName);
		if(parm.pageType != 1) {
			$(".contractPortletTitle").addClass("contractPortletPageTitle");
		};
		$(".wcardNumber").text(data.wcardNumber);
		$(".wcardStatus").text(ticketStateType[data.wcardStatus]);
		$(".contractPortletTitle").removeClass("hidden");
		if(contractNature == null || contractNature == 1){
			$("#relationshipContract").remove();
			if(isFixed){
				$("#defalutContract").removeClass("hidden");
			}
		}else{
			$("#defalutContract").remove();
			$("#relationshipContract").removeClass("hidden");
			$("#relatedDom0").removeClass("hidden");
			var relatedWcardNumber = data.relatedWcardNumber
			if(relatedWcardNumber == null){
				$("#relatedWcardNumber").html("<a>暂无关联工单编号</a>");
			}else{
				setRelatedWcardNumber(relatedWcardNumber)
			};
			if(contractNature == 2){
				if(isFixed){
					$("#relationshipIsFixed").removeClass("hidden");
					$("#contractValueLable").text("变更后含增值税合同金额：");
					$("#contractValueNovatLable").text("变更后不含增值税合同金额：");
					$("#vatRateLable").text("变更后增值税税率：");
				}
			}else if(contractNature == 3){
				if(isFixed){
					$("#relationshipIsFixed").removeClass("hidden");
					$("#contractValueLable").text("终止解除后含增值税合同金额：");
					$("#contractValueNovatLable").text("终止解除后不含增值税合同金额：");
					$("#vatRateLable").text("终止解除后增值税税率：");
				}
			}else{
				if(isFixed){
					$("#relationshipIsFixed").removeClass("hidden");
					$("#contractValueLable").text("含增值税合同金额：");
					$("#contractValueNovatLable").text("不含增值税合同金额：");
					$("#vatRateLable").text("增值税税率：");
					$("#originalContractValueContent,#originalContractValueNovatContent,#originalVatRateContent").remove();
				}
			}
		};
		var valueCallback = {
			"executeStatus":function(value){return performanceState[value]},
			"contractNature":function(value){
				if(value == 2){
					return "变更/补充";
				}else if(value == 3){
					return "终止解除";
				}else if(value == 4){
					return "续签合同";
				}else if(value == 5){
					return "子合同";
				}else{
					return "未知";
				}
			},
			"vatRate":function(value){
				if(value == null || value == ""){
					value = '';
				}else if(value == "多税率" || value == "0"){
					value = value;
				}else{
					value = value + "%";
				};
				return value;
			},
			"originalVatRate":function(value){
				if(value == null || value == ""){
					value = '';
				}else if(value == "多税率" || value == "0"){
					value = value;
				}else{
					value = value + "%";
				};
				return value;
			},
			"contractValue":function(value){
				return createMoneyStyle(value);
			},
			"contractValueNovat":function(value){
				return createMoneyStyle(value);
			},
			"originalContractValue":function(value){
				return createMoneyStyle(value);
			},
			"originalContractValueNovat":function(value){
				return createMoneyStyle(value);
			}
		}; 
		App.setFormValues("#contractOverviewForm",data,valueCallback);
	}
	/*
	 * 加载关联工单合同编号
	 */
	function setRelatedWcardNumber(relatedWcardNumber){
		App.formAjaxJson(serverPath + "contractOrderEditorController/listDomainInfo", "post", JSON.stringify({relatedWcardNumber:relatedWcardNumber}), successCallback);
		function successCallback(result) {
			var data = result.data;
			if(data.length > 0){
				var id = data[0].wcardId;
				$("#relatedWcardNumber").html("<a onclick='jumpContractOverview(\""+id+"\")'>"+relatedWcardNumber+"</a>");
			}else{
				$("#relatedWcardNumber").html("<a>暂无关联工单编号</a>");
			};
		}
	}
	/*
	 * 跳转新页面
	 */
	function jumpContractOverview(id){
		var href = "/html/contReg/workOrderEdit/workOrderEdit.html?pageType=0&askFlag=yb&taskDefinitionKey=GDQR&wcardId="+id;
		if(parm.pageType == 1){
			parent.layer.confirm("开启新页面来查看此关联工单",{icon:7,title:"提示"},function(index){
				parent.layer.close(index);
				top.showSubpageTab(href,"关联工单查看",true);
			})
		}else{
			layer.confirm("开启新页面来查看此关联工单",{icon:7,title:"提示"},function(index){
				layer.close(index);
				top.showSubpageTab(href,"关联工单查看",true);
			})
		}
	}
	/*
	 * 金额信息RP样式生成
	 */
	function createMoneyStyle(num){
		if(num == 0){
			return "零"
		};
		if(num == null){
			return ""
		};
		var returnValue = "人民币：";
		returnValue += App.unctionToThousands(num);
		returnValue += "元";
		returnValue += "    " + chineseNumber(num);
		return returnValue;
	}
	
	/*
	 * 更多信息展示和隐藏
	 */
	$("#partyMore").on("click",function(){
		if($("#partyContent").hasClass("hidden")){
			$("#partyContent").removeClass("hidden");
			$("#partyMore").text("隐藏");
		}else{
			$("#partyContent").addClass("hidden");
			$("#partyMore").text("更多");
		}
	})
	/*
	 * 添加验证
	 */
	var phoneValidator = {
		regexp: {
			regexp: /^((\+86)|(86))?[1][3456789][0-9]{9}$|^([0-9]{3,4}-)?[0-9]{7,8}(-[0-9]{3,4})?$/,
    		message: '联系电话输入错误'
		}
	}
   	App.addValidatorField("#workOrderContentForm","partyATelephone",phoneValidator);
   	App.addValidatorField("#workOrderContentForm","partyZTelephone",phoneValidator);
   	
</script>