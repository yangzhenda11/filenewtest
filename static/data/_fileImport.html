<style type="text/css">
	.fileImportModalBody .form-group {
		display: table;
	}
	
	.fileImportModalBody .form-group>label {
		width: 15%;
		min-height: 1px;
		line-height: 16px;
		padding: 0 10px 0 0;
		vertical-align: middle;
		display: table-cell;
		text-align: right;
	}
	
	.fileImportModalBody .form-group>.valiParent {
		width: 100%;
		float: left;
		position: relative;
		min-height: 1px;
		padding-left: 10px;
		padding-right: 10px;
	}
	
	.progress {
		margin-bottom: 0;
	}
	
	#scheduleDiv {
		margin: 10px 0 20px 0;
	}
	
	.fileImportChoose {
		padding: 4px 15px;
		height: 32px;
		line-height: 24px;
		position: relative;
		cursor: pointer;
		color: #fff;
		background: #e43a45;
		border: 1px solid #e43a45;
		border-radius: 4px;
		overflow: hidden;
		display: inline-block;
		*display: inline;
		*zoom: 1
	}
	
	.fileImportChoose input {
		position: absolute;
		font-size: 100px;
		right: 0;
		top: 0;
		opacity: 0;
		filter: alpha(opacity=0);
		cursor: pointer
	}
	
	.fileImportChoose:hover {
		color: #fff;
		background: #cf1c28;
		border-color: #c61b26;
		text-decoration: none
	}
	#fileImportName{
		color: #337ab7;
	}
	.fileImportBtn{
		margin: 0 10px;
	}
	
	.chooseImportFile{
		border-color: #2e6da4;
		color: #fff;
		background: #337ab7;
	}
	.chooseImportFile:hover{
		border-color: #2e6da4;
		color: #fff;
		background: #337ab7;
	}
</style>
<div class="modal-dialog" role="document">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="fileUploadModalLabel"></h4>
		</div>
		<div class="modal-body fileImportModalBody">
			<form id='fileImportModalForm' action='' method='post' enctype="multipart/form-data">
				<div class="form-group col-sm-12">
					<label for="partnerCode" class="control-label">文件</label>
					<div class="valiParent">
						<a class="fileImportChoose" id="fileImportChoose">
							<input type="file" name="file" id="file" accept="" />点击选择文件
						</a>
						<div id="fileImportResult" class="hidden">
							<a id="fileImportName"></a>
							<button type="button" class="btn red fileImportBtn" onclick="fileImportPost()">导入</button>
							<button type="button" class="btn yellow" onclick="resetFileImport()">重置</button>
						</div>
						
					</div>
				</div>
				<!--<div class="form-group col-sm-12">
					<label for="partnerCode" class="control-label">文件</label>
					<div class="valiParent">
						<div class="input-group">
							<input type="text" id="fileInput" name="fileInput" disabled="disabled" class="form-control">
							<span class="input-group-addon"><i class="glyphicon glyphicon-repeat"></i>  重置</span>
							<span class="input-group-addon"><i class="glyphicon glyphicon-upload"></i>  导入</span>
							<div class="input-group-addon btn chooseImportFile"><i class="glyphicon glyphicon-folder-open"></i> 选择文件
							<input type="file" name="file" id="file" class="hidden" accept="" />
							</div>
						</div>
						
					</div>
				</div>-->
				<div class="form-group col-sm-12 hidden" id="scheduleDiv">
					<label for="partnerCode" class="control-label">进度</label>
					<div class="valiParent">
						<div class="progress" id="scheduleProgress">
							<div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="schedule"></div>
						</div>
					</div>
				</div>
				<div class="form-group col-sm-12">
					<label for="partnerCode" class="control-label">导入说明</label>
					<div class="valiParent" id="fileUpliadExplain" style="color: red;">
						<i class="iconfont icon-mi required"></i>请按照下载模板中文件的格式和内容进行导入。</br>
					</div>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-default btn-circle" data-dismiss="modal"><i class="iconfont icon-close"></i> 关闭</button>
		</div>
	</div>
</div>

<script type="text/javascript">
	//系统全局变量获取
	var config = top.globalConfig;
	var serverPath = config.serverPath;
	var fileImportCallback = null;
	var fileImportUrl = '';
	var fileImportPostfix = null;
	/*
	 * 检测选择文件按钮点击
	 */
	$(".fileImportChoose").on("change","input[type='file']",function(){
	    var filePath=$(this).val();
	    var flag = false;
	    if(filePath){
	    	if(fileImportPostfix){
	    		$.each(fileImportPostfix,function(k,v){
	    			if(filePath.indexOf("."+v) != -1){
	    				flag = true;
	    				return true;
	    			}
	    		})
	    	}else{
	    		flag = true;
	    	};
	    	if(flag){
	    		var arr=filePath.split('\\');
		        var fileName=arr[arr.length-1];
		        $("#fileImportChoose").addClass("hidden");
		        $("#fileImportResult").removeClass("hidden");
		        $("#fileImportName").html(fileName);
	    	}else{
	    		var typeText = "";
	    		$.each(fileImportPostfix,function(k,v){
	    			typeText += "."+v +"，"; 
	    		})
	    		typeText = typeText.substring(0,typeText.length-1);
	    		layer.alert("请选择"+typeText+"格式的文件",{title:"格式错误",icon:2});
				return false;
	    	}
	    }
	})
	//设置参数
	function setParm(setting, callback) {
		var fileUploadModalLabel = setting.title == undefined ? "文件导入" : setting.title;
		$("#fileUploadModalLabel").text(fileUploadModalLabel);
		$("#commomModal").modal("show");
		var emptyFn = function() {};
		fileImportCallback = callback == null || callback == "" ? emptyFn : callback;
		fileImportUrl = setting.url;
		if(setting.postfix){
			fileImportPostfix = setting.postfix;
		}
		if(setting.accept) {
			$("#file").attr("accept", setting.accept);
		};
		if(setting.extraData) {
			$.each(setting.extraData, function(k, v) {
				var html = '<input type="hidden" name="' + k + '" value="' + v + '" />';
				$("#fileImportModalForm").append(html);
			});
		};
	}
	/*
	 * 文件导入上传
	 */
	function fileImportPost() {
		$("#fileImportModalForm").ajaxSubmit({
			//dataType: 'json',
			url: serverPath + fileImportUrl,
			resetForm: "true",
			timeout: 30000,
			beforeSend: function() {
				//resetProgerss();
			},
			success: function(result) {
				resetFileImport();
				fileImportCallback(result);
			},
			error: function(result) {
				App.ajaxErrorCallback(result);
			}
		})
	}
	/*
	 * 文件重置
	 */
	function resetFileImport(){
		$("#fileImportChoose").removeClass("hidden");
		$("#fileImportResult").addClass("hidden");
		$("#file").val("");
		$("#fileImportName").html("");
	}
	
//	var scheduleLen = null;
//	var progersstimer = null;
//
//	function resetProgerss() {
//		scheduleLen = 8;
//		$("#schedule").css("width", "8%");
//		$("#scheduleDiv").removeClass("hidden progress-bar-success progress-bar-danger");
//		startProgerss();
//	}
//	//进度条开始控制 
//	function startProgerss() {
//		scheduleLen += 1;
//		$("#schedule").css("width", scheduleLen + "%");
//		$("#schedule").text("导入中");
//		if(scheduleLen < 95) {
//			progersstimer = setTimeout(startProgerss, 30);
//		}
//	}
//	//进度条结束控制 
//	function endProgerss(parm) {
//		clearTimeout(progersstimer);
//		runEndProgerss();
//
//		function runEndProgerss() {
//			scheduleLen += 1;
//			$("#schedule").css("width", scheduleLen + "%");
//			if(scheduleLen < 100) {
//				endProgersstimer = setTimeout(runEndProgerss, 10);
//			} else {
//				if(parm) {
//					$("#schedule").text("导入成功");
//					$("#schedule").addClass("progress-bar-success");
//				} else {
//					$("#schedule").text("导入失败");
//					$("#schedule").addClass("progress-bar-danger");
//				}
//			}
//		}
//	}
</script>