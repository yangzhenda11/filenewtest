<link rel="stylesheet" type="text/css" href="../../../static/data/css/commonModal.css"/>
<div class="modal-dialog" role="document" style="width: 90%;">
	<div class="modal-content">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="myModalLabel">合同查询</h4>
		</div>
		<div class="modal-body commonModalTableBody">
			<div class="portlet-body">
				<div class="pageSearchContent">
					<div class="page-search">
						<form autocomplete="off" class="form-horizontal">
						<div class="row page-search-form">
							<div class="col-sm-4">
								<div class="input-group">
									<span class="input-group-addon searchLableText">合同名称</span>
									<input type="text" class="form-control" name="contractName" >
								</div>
							</div>
							<div class="col-sm-4">
								<div class="input-group">
									<span class="input-group-addon searchLableText">合同编号</span>
									<input type="text" class="form-control" name="contractNumber" >
								</div>
							</div>
							<div class="input-group">
								<button type="button" id="searchBtnM" class="btn red" data-loading-text="加载中.." onclick="searchContractData();"><i class="iconfont icon-search"></i>查询</button>
								<button type="reset" class="btn yellow" onclick="App.resetForm(this)"><i class="iconfont icon-reset"></i>清空</button>
							</div>
						</div>
						</form>
					</div>
				</div>
				<div id="contractTableDom" class="tableContent">
					<table id="contractDataTable" class="table table-striped table-bordered table-hover table-header-fixed"></table>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<button type="button" onclick="checkContractData()" class="btn btn-danger btn-circle"><i class="iconfont icon-baocun"></i>确定</button>
			<button type="button" class="btn btn-default btn-circle" data-dismiss="modal"><i class="iconfont icon-close"></i>关闭</button>
		</div>
	</div>
</div>
<script type="text/javascript">
	//系统全局变量获取
	var serverPath = top.globalConfig.serverPath;
	var _documentHeight = 0;
	var _dom = null,_showInputKey=null,_setKey=null,_ajaxData=null;
	//初始化表格
	function initContractDataSearch(dom, showInputKey, setKey, ajaxData) {
		$("#commomModal").modal("show");
		_documentHeight = $(".page-content").height() - 340;
		_dom = dom;
		_showInputKey = showInputKey;
		_setKey = setKey;
		_ajaxData = ajaxData;
		$("#contractTableDom").css("height",_documentHeight + 90);
	}
	//modal全部显示后的回调
	$('#commomModal').off("shown.bs.modal").on('shown.bs.modal', function (e) {
		getContractData();
	})
	/*
	 * 加载datatable表格
	 */
	function getContractData() {
		if(App.isIE9() || App.isIE8()){
			_documentHeight = "";
		}
		App.initDataTables('#contractDataTable', "#searchBtnM", {
			scrollY:_documentHeight,
			ajax: {
				"type": "post",
				"contentType": "application/json",
				"url": serverPath + 'contractBaseInfo/listContractByUndertakerId',
				"data": function(d) {
					d.contractName = $("input[name='contractName']").val().trim();
					d.contractNumber = $("input[name='contractNumber']").val().trim();
					var parm = $.extend({}, _ajaxData, d);
					return JSON.stringify(parm);
				}
			},
			"columns": [{
					"data": "contractId",
					"className": "text-center radioCheck",
					"title": "操作",
					"render": function(data, type, full, meta) {
						var radioHtml = "<label class='ui-radio'><input type='radio' name='checkRadio'><span></span></label>";
						return radioHtml;
					}
				},
				{
					"data": "contractName",
					"title": "合同名称",
					"className":"whiteSpaceNormal",
					"width":"35%"
				},
				{
					"data": "contractNumber",
					"title": "合同编号"
				},
				{
					"data": "partyName",
					"title": "对方主体名称"
				}
			],
			"columnDefs": [{
	       		"createdCell": function (td, cellData, rowData, row, col) {
		         	if ( col > 0 ) {
		           		$(td).attr("title", $(td).text())
		         	}
	       		}
	     	}]
		});
		//行点击事件  
		$('#contractDataTable tbody').on('click', 'tr', function() {
			$(this).find("input[name='checkRadio']").prop("checked", true);
		});
	}
	//搜索点击事件
	function searchContractData() {
		var table = $('#contractDataTable').DataTable();
		table.ajax.reload();
	}
	//点击确定页面dom元素选择值
	function checkContractData() {
		//获取选择行的内容
		var checkedRadio = $("#contractDataTable").find("input[name='checkRadio']:checked");
		if(checkedRadio.length == 0){
			layer.msg("请选择一项合同",{icon:2})
		}else{
			var trIndex = $("input[name='checkRadio']:checked").parents("tr").index();
			var checkedTrData = $('#contractDataTable').DataTable().row(trIndex).data();
			if(_setKey != undefined){
				if($.isArray(_setKey)){
					$.each(_setKey, function(k,v) {
						$(_dom).data(v,checkedTrData[v]);
					});
				}else{
					$(_dom).data(_setKey,checkedTrData[_setKey]);
				}
			};
			$(_dom).val(checkedTrData[_showInputKey]);
			$(_dom).data("exactSearch",true);
			$("#commomModal").modal("hide");
		}
	}
</script>