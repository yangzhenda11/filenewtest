function initFrame(){serarch(),$("#searchContent").show()}function resetCondition(){$("input[name='startDate']").val(""),$("input[name='endDate']").val("")}function serarch(){searchTable.ajax.reload()}function updateStatus(acthId,status,endTime,startTime,ownerId,flowKey){var data={acthId:acthId,status:status,endTime:endTime,startTime:startTime,ownerId:ownerId,flowKey:flowKey},title="禁用";"1"==status&&(title="启用"),confirm("确定"+title+"此条数据?")&&$.ajax({url:"disableTaskDelegates",data:data,dataType:"text",type:"POST",success:function(data){if("1"==data)alert(title+"成功！");else if("2"==data)alert("启用失败，当前时间已经超出所设定的时间。");else{repeatShow();var html;eval("var data="+data);for(var i=0;i<data.length;i++)html+="<tr><td>"+data[i].ownerId+"</td><td>"+data[i].assigneeId+"</td><td>"+data[i].flowKey+"</td><td>"+getSmpFormatDateByLong(data[i].startTime,!0)+"</td><td>"+getSmpFormatDateByLong(data[i].endTime,!0)+"</td><td>"+getSmpFormatDateByLong(data[i].createTime,!0)+"</td><td>"+getSmpFormatDateByLong(data[i].lastUpdateTime,!0)+'</td><td style="word-wrap:break-word;word-break:break-all;">'+data[i].remark+"</td></tr>";$("#repeatContent").html(html)}searchTable.draw(!1)},error:function(t){alert(title+"时信息异常："+t),App.ajaxErrorCallback(t)}})}function showAddPage(){getSelectFlowKey(),$(".add").show(),$("#editTaskDelegateEntityModal").show(),$("#permModalLabel1").show(),$("#searchContent").hide()}function goBack(){$("#editTaskDelegateEntityModal").hide(),$("#searchContent").show(),resetForm()}function ifclick(){isClick=!0}function resetForm(){$("#editTaskDelegateEntityForm").data("bootstrapValidator")&&$("#editTaskDelegateEntityForm").data("bootstrapValidator").resetForm(!0)}function addTaskDelegateEntity(){$.ajax({url:"addNewTaskDelegate.action",data:$("#editTaskDelegateEntityForm").serialize(),dataType:"text",type:"POST",success:function(data){if(eval("var data = "+data),data[0].flag)serarch(),$("#editTaskDelegateEntityModal").hide(),isClick=!1,$("#searchContent").show(),alert("添加成功！"),resetForm();else{repeatShow();for(var html,i=0;i<data.length;i++)html+="<tr><td>"+data[i].ownerId+"</td><td>"+data[i].assigneeId+"</td><td>"+data[i].flowKey+"</td><td>"+getSmpFormatDateByLong(data[i].startTime,!0)+"</td><td>"+getSmpFormatDateByLong(data[i].endTime,!0)+"</td><td>"+getSmpFormatDateByLong(data[i].createTime,!0)+"</td><td>"+getSmpFormatDateByLong(data[i].lastUpdateTime,!0)+'</td><td style="word-wrap:break-word;word-break:break-all;">'+data[i].remark+"</td></tr>";$("#repeatContent").html(html),$("#startTime").val("")}},error:function(t){alert("添加信息时异常："+t),App.ajaxErrorCallback(t)}})}function getSelectFlowKey(){$("#flowKey").empty(),$.ajax({url:"getSelectFlowKey.action",type:"POST",success:function(t){$.each(t,function(t,e){$("#flowKey").append("<option value='"+e.flowkey+"'>"+e.flowname+"</option>")})},error:function(t){alert("获取类型下拉数据时信息异常："+t),App.ajaxErrorCallback(t)}})}function repeatShow(){$("#repeat").modal("show")}function repeatClose(){$("#addBtn").button("reset"),$("#repeat").modal("hide")}function getDate(){$("#addBtn").button("reset"),WdatePicker({dateFmt:"yyyy-MM-dd HH:mm:ss"})}$(function(){searchTable=$("#searchTable").DataTable(dataTableConfig),$("#editTaskDelegateEntityForm").bootstrapValidator(validator)});var btnModel='    	{{#each func}}    <button type="button" class="user-button btn-sm {{this.type}}" {{this.title}} {{this.fn}}>{{this.name}}</button>    {{/each}}',template=Handlebars.compile(btnModel),searchTable,dataTableConfig={ordering:!1,serverSide:!0,scrollX:!0,ajax:{type:"POST",url:"delegateManagerList",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",data:function(t){return t.startDate=$("#startDateDelegate").val(),t.endDate=$("#endDateDelegate").val(),t}},columns:[{data:"ownerId",title:"委托人",className:"text-center"},{data:"assigneeId",title:"被委托人",className:"text-center"},{data:"flowKey",title:"类型",className:"text-center",render:function(t){return t.split("&")[0]}},{data:"startTime",title:"开始时间",className:"text-center",render:function(t){return getSmpFormatDateByLong(t,!0)}},{data:"endTime",title:"结束时间",className:"text-center",render:function(t){return getSmpFormatDateByLong(t,!0)}},{data:"createTime",title:"录入时间",className:"text-center",render:function(t){return getSmpFormatDateByLong(t,!0)}},{data:"lastUpdateTime",title:"更新时间",className:"text-center",render:function(t){return getSmpFormatDateByLong(t,!0)}},{data:"remark",title:"备注",className:"text-center"},{data:null,title:"操作",className:"text-center"}],columnDefs:[{targets:"_all",defaultContent:""},{targets:-1,render:function(t,e,a){var r=a.status,n="启用",i="onclick=updateStatus('"+a.authId+"',1,'"+a.endTime+"','"+a.startTime+"','"+a.ownerId+"','"+a.flowKey.split("&")[1]+"')";"1"==r&&(n="禁用",i="onclick=updateStatus('"+a.authId+"',0,'"+a.endTime+"','"+a.startTime+"','"+a.ownerId+"','"+a.flowKey.split("&")[1]+"')");var d={func:[{name:n,title:"",fn:i,type:""}]},o=template(d);return o}}],dom:'rt<"pull-left mt5"i><"pull-right mt5"p><"clear">'},isClick=!1,validator={message:"This value is not valid",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},submitHandler:function(){if(isClick){var t=$("#startTime").val(),e=$("#endTime").val();if(""==t)return void alert("请选择开始时间。");if(""==e)return void alert("请选择结束时间。");addTaskDelegateEntity()}},fields:{ownerId:{validators:{notEmpty:{message:"请输入委托人"},numeric:{message:"只能输入纯数字"},stringLength:{min:0,max:255,message:"委托人不能超过255位"}}},assigneeId:{validators:{notEmpty:{message:"请输入被委托人"},numeric:{message:"只能输入纯数字"},stringLength:{min:0,max:255,message:"被委托人不能超过255位"}}},flowKey:{validators:{notEmpty:{message:"请输入类型"},stringLength:{min:0,max:64,message:"类型不能超过64位"}}},startTime:{validators:{date:{format:"yyyy-MM-dd HH:mm:ss",message:"请输入开始时间"}}},endTime:{validators:{date:{format:"yyyy-MM-dd HH:mm:ss",message:"请输入开始时间"}}},remark:{validators:{stringLength:{min:0,max:255,message:"备注不能超过255位"}}}}};