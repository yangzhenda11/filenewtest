function getContractInfo(){function t(t){var a=t.data;a?($("#contractNumber").val(a.contractNumber),$("#undertakeName").val(a.undertakeName),$("#undertakePhone").val(a.undertakePhone),$("#undertakeMobile").val(a.undertakeMobile),$("#contractName").val(a.contractName),$("#executeDeptName").val(a.executeDeptName),$("#unicomPartyName").text(a.unicomPartyName),$("#oppoPartyName").text(a.oppoPartyName),$("#contractType").text(a.contractType)):layer.msg("暂无合同信息")}var a=serverPath+"contractUpload/getContractById?id="+scandocId;App.formAjaxJson(a,"post",null,t)}function getReplenishContractInfo(){function t(t){var a=t.data;a?(setBodyDocData(a.bodyDoc),setAttachDocData(a.attachDoc)):(layer.msg("暂无数据"),$("#contractTextUploadBtn").attr("disabled","disabled"))}var a=serverPath+"contractUpload/getReplenishContractInfo",o={id:scandocId};App.formAjaxJson(a,"post",JSON.stringify(o),t)}function setBodyDocData(t){if(t){var a="";t.bodyDocStoreId?($("#contractText").removeClass("col-sm-4").addClass("contractDocSty"),$("#contractTextUploadBtn").text("删除"),$("#contractText").data("storeid",t.bodyDocStoreId),a='<a href="'+serverPath+"fileload/downloadS3?key="+t.bodyDocStoreId+'">'+t.displayName+"</a>"):($("#contractTextUploadBtn").text("添加"),a='<input type="text" disabled="disabled" class="form-control" />',$("#contractText").data("storeid","")),$("#contractText").html(a),$("#contractText").data("attachid",t.attachId),$("#contractText").data("displayname",t.displayName)}else layer.msg("获取不到合同正文扫描件信息"),$("#contractTextUploadBtn").attr("disabled","disabled")}function setAttachDocData(t){if(t.length>0)for(var a="",o=0;o<t.length;o++){var e=t[o],c="";e.bodyDocStoreId?(c='<a href="'+serverPath+"fileload/downloadS3?key="+e.bodyDocStoreId+'">查看</a><a class="attachDelectBtn marginLeft25">删除</a>',a+='<tr data-attachid="'+e.attachId+'" data-storeid="'+e.bodyDocStoreId+'">'):(c='<button type="button" class="btn primary btn-outline btn-xs attachUploadBtn">添加</button>',a+='<tr data-attachid="'+e.attachId+'" data-storeid="">'),a+="<td>"+(o+1)+"</td><td>"+e.displayName+"</td><td>"+c+"</td></tr>"}$("#contractAttachmentTbody").html(a)}function getContractUploadInfo(t){var a=[],o={};$.each($("#contractAttachmentTbody tr"),function(t,o){if(!$(o).hasClass("emptyTr")){var e={attachId:$(o).data("attachid"),bodyDocStoreId:$(o).data("storeid")};a.push(e)}});var e=$("#contractText").data("storeid");if(e)o.bodyDoc={attachId:$("#contractText").data("attachid"),bodyDocStoreId:e};else{if(void 0==e)return layer.msg("合同正文扫描件信息为空"),!1;o.bodyDoc={attachId:$("#contractText").data("attachid"),bodyDocStoreId:""}}return o.attachDoc=a,o.uploadStatus=t,o.scandocId=scandocId,o}function saveContractUpload(){function t(){layer.msg("保存成功")}var a=getContractUploadInfo(1);if(a){var o=serverPath+"contractUpload/saveReplenishContractInfo";App.formAjaxJson(o,"post",JSON.stringify(a),t)}}function pushContractUpload(){function t(){layer.msg("提交成功");setTimeout("backPage()",1e3)}var a=getContractUploadInfo(3);if(a)if(a.bodyDoc.bodyDocStoreId){var o=serverPath+"contractUpload/saveReplenishContractInfo";App.formAjaxJson(o,"post",JSON.stringify(a),t)}else layer.msg("请上传合同正文扫描件后进行提交")}function backPage(){window.history.go(-1)}var parm=App.getPresentParm();if(1==parm.pageType)var scandocId=parm.businessKey;else if(2==parm.pageType)var scandocId=parm.id;var config=top.globalConfig,serverPath=config.serverPath;$(function(){1==parm.pageType?($(".toolbarBtn,.portlet-title").remove(),$(".page-content,.portlet-body").css("padding","0px"),$(".portlet").css("cssText","border:none !important;padding:0px"),$(".page-content").removeClass("hidden")):2==parm.pageType&&($(".page-content").removeClass("hidden"),App.fixToolBars("toolbarBtnContent",70)),getContractInfo(),getReplenishContractInfo()}),$("#contractTextUploadBtn").on("click",function(){function t(){var t=getFileItemInfo()[0].data;$("#commomModal").modal("hide");var a='<a href="'+serverPath+"fileload/downloadS3?key="+t+'">'+o+"</a>";$("#contractText").removeClass("col-sm-4").addClass("contractDocSty"),$("#contractText").html(a),$("#contractTextUploadBtn").text("删除"),$("#contractText").data("storeid",t)}var a=$("#contractText").data("storeid");if(a)layer.confirm("是否要删除已上传的正文扫描件",{icon:7,title:"提示"},function(t){layer.close(t);var a='<input type="text" disabled="disabled" class="form-control" />';$("#contractText").data("storeid",""),$("#contractText").removeClass("contractDocSty").addClass("col-sm-4"),$("#contractText").html(a),$("#contractTextUploadBtn").text("添加")});else{var o=($("#contractText").data("attachid"),$("#contractText").data("displayname")),e={title:"正文上传",url:"fileload/uploadFileS3",maxNumber:1,fileExtensions:["pdf"],extraData:{displayName:o}};App.getFileUploadModal(e,t)}}),$("#contractAttachmentTbody").on("click",".attachDelectBtn",function(){var t=$(this);layer.confirm("是否要删除已上传的附件扫描件",{icon:7,title:"提示"},function(a){layer.close(a);var o='<button type="button" class="btn primary btn-outline btn-xs attachUploadBtn">添加</button>';t.parents("tr").data("storeid",""),t.parent("td").html(o)})}),$("#contractAttachmentTbody").on("click",".attachUploadBtn",function(){function t(){var t=getFileItemInfo()[0].data;$("#commomModal").modal("hide");var o='<a href="'+serverPath+"fileload/downloadS3?key="+t+'">查看</a><a class="attachDelectBtn marginLeft25">删除</a>';a.parents("tr").data("storeid",t),a.parent("td").html(o)}var a=$(this),o=($(this).parents("tr").data("attachid"),{title:"附件上传",url:"fileload/uploadFileS3",maxNumber:1});App.getFileUploadModal(o,t)});